{"version":3,"sources":["../../src/fields/variantsFields.ts"],"sourcesContent":["import type { Field, FilterOptionsProps } from 'payload'\n\ntype Props = {\n  /**\n   * Multi-tenant configuration for variants.\n   * When enabled, the variantTypes relationship will be filtered by the product's tenant.\n   */\n  multiTenant?: {\n    enabled: boolean\n    tenantsSlug?: string\n  }\n  /**\n   * Slug of the variants collection, defaults to 'variants'.\n   */\n  variantsSlug?: string\n  /**\n   * Slug of the variant types collection, defaults to 'variantTypes'.\n   */\n  variantTypesSlug?: string\n}\n\nexport const variantsFields: (props: Props) => Field[] = ({\n  multiTenant,\n  variantsSlug = 'variants',\n  variantTypesSlug = 'variantTypes',\n}) => {\n  // Filter variant types by tenant when multi-tenant is enabled\n  const tenantFilterOptions = multiTenant?.enabled\n    ? ({ data }: FilterOptionsProps) => {\n        const tenantId = typeof data?.tenant === 'object' ? data?.tenant?.id : data?.tenant\n        if (tenantId) {\n          return { tenant: { equals: tenantId } }\n        }\n        return true\n      }\n    : undefined\n\n  const fields: Field[] = [\n    {\n      name: 'enableVariants',\n      type: 'checkbox',\n      label: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:enableVariants'),\n    },\n    {\n      name: 'variantTypes',\n      type: 'relationship',\n      admin: {\n        condition: ({ enableVariants }) => Boolean(enableVariants),\n      },\n      ...(tenantFilterOptions && { filterOptions: tenantFilterOptions }),\n      hasMany: true,\n      label: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:variantTypes'),\n      relationTo: variantTypesSlug,\n    },\n    {\n      name: 'variants',\n      type: 'join',\n      admin: {\n        condition: ({ enableVariants, variantTypes }) => {\n          const enabledVariants = Boolean(enableVariants)\n          const hasManyVariantTypes = Array.isArray(variantTypes) && variantTypes.length > 0\n\n          return enabledVariants && hasManyVariantTypes\n        },\n        defaultColumns: ['title', 'options', 'inventory', 'prices', '_status'],\n        disableListColumn: true,\n      },\n      collection: variantsSlug,\n      label: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:availableVariants'),\n      maxDepth: 2,\n      on: 'product',\n    },\n  ]\n\n  return fields\n}\n"],"names":["variantsFields","multiTenant","variantsSlug","variantTypesSlug","tenantFilterOptions","enabled","data","tenantId","tenant","id","equals","undefined","fields","name","type","label","t","admin","condition","enableVariants","Boolean","filterOptions","hasMany","relationTo","variantTypes","enabledVariants","hasManyVariantTypes","Array","isArray","length","defaultColumns","disableListColumn","collection","maxDepth","on"],"mappings":"AAqBA,OAAO,MAAMA,iBAA4C,CAAC,EACxDC,WAAW,EACXC,eAAe,UAAU,EACzBC,mBAAmB,cAAc,EAClC;IACC,8DAA8D;IAC9D,MAAMC,sBAAsBH,aAAaI,UACrC,CAAC,EAAEC,IAAI,EAAsB;QAC3B,MAAMC,WAAW,OAAOD,MAAME,WAAW,WAAWF,MAAME,QAAQC,KAAKH,MAAME;QAC7E,IAAID,UAAU;YACZ,OAAO;gBAAEC,QAAQ;oBAAEE,QAAQH;gBAAS;YAAE;QACxC;QACA,OAAO;IACT,IACAI;IAEJ,MAAMC,SAAkB;QACtB;YACEC,MAAM;YACNC,MAAM;YACNC,OAAO,CAAC,EAAEC,CAAC,EAAE,GACX,+DAA+D;gBAC/DA,EAAE;QACN;QACA;YACEH,MAAM;YACNC,MAAM;YACNG,OAAO;gBACLC,WAAW,CAAC,EAAEC,cAAc,EAAE,GAAKC,QAAQD;YAC7C;YACA,GAAIf,uBAAuB;gBAAEiB,eAAejB;YAAoB,CAAC;YACjEkB,SAAS;YACTP,OAAO,CAAC,EAAEC,CAAC,EAAE,GACX,+DAA+D;gBAC/DA,EAAE;YACJO,YAAYpB;QACd;QACA;YACEU,MAAM;YACNC,MAAM;YACNG,OAAO;gBACLC,WAAW,CAAC,EAAEC,cAAc,EAAEK,YAAY,EAAE;oBAC1C,MAAMC,kBAAkBL,QAAQD;oBAChC,MAAMO,sBAAsBC,MAAMC,OAAO,CAACJ,iBAAiBA,aAAaK,MAAM,GAAG;oBAEjF,OAAOJ,mBAAmBC;gBAC5B;gBACAI,gBAAgB;oBAAC;oBAAS;oBAAW;oBAAa;oBAAU;iBAAU;gBACtEC,mBAAmB;YACrB;YACAC,YAAY9B;YACZa,OAAO,CAAC,EAAEC,CAAC,EAAE,GACX,+DAA+D;gBAC/DA,EAAE;YACJiB,UAAU;YACVC,IAAI;QACN;KACD;IAED,OAAOtB;AACT,EAAC"}