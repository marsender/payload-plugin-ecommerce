{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import type { Config, Endpoint } from 'payload'\n\nimport { deepMergeSimple } from 'payload/shared'\n\nimport type { EcommercePluginConfig, SanitizedEcommercePluginConfig } from './types/index.js'\n\nimport { createAddressesCollection } from './collections/addresses/createAddressesCollection.js'\nimport { createCartsCollection } from './collections/carts/createCartsCollection.js'\nimport { createOrdersCollection } from './collections/orders/createOrdersCollection.js'\nimport { createProductsCollection } from './collections/products/createProductsCollection.js'\nimport { createTransactionsCollection } from './collections/transactions/createTransactionsCollection.js'\nimport { createVariantOptionsCollection } from './collections/variants/createVariantOptionsCollection.js'\nimport { createVariantsCollection } from './collections/variants/createVariantsCollection/index.js'\nimport { createVariantTypesCollection } from './collections/variants/createVariantTypesCollection.js'\nimport { confirmOrderHandler } from './endpoints/confirmOrder.js'\nimport { initiatePaymentHandler } from './endpoints/initiatePayment.js'\nimport { translations } from './translations/index.js'\nimport { getCollectionSlugMap } from './utilities/getCollectionSlugMap.js'\nimport { pushTypeScriptProperties } from './utilities/pushTypeScriptProperties.js'\nimport { sanitizePluginConfig } from './utilities/sanitizePluginConfig.js'\n\nexport const ecommercePlugin =\n  (pluginConfig?: EcommercePluginConfig) =>\n  async (incomingConfig: Config): Promise<Config> => {\n    if (!pluginConfig) {\n      return incomingConfig\n    }\n\n    const sanitizedPluginConfig = sanitizePluginConfig({ pluginConfig })\n    /**\n     * Used to keep track of the slugs of collections in case they are overridden by the user.\n     */\n    const collectionSlugMap = getCollectionSlugMap({ sanitizedPluginConfig })\n\n    const accessConfig = sanitizedPluginConfig.access\n\n    // Ensure collections exists\n    if (!incomingConfig.collections) {\n      incomingConfig.collections = []\n    }\n\n    // Controls whether variants are enabled in the plugin. This is toggled to true under products config\n    let enableVariants = false\n\n    const currenciesConfig: Required<SanitizedEcommercePluginConfig['currencies']> =\n      sanitizedPluginConfig.currencies\n\n    let addressFields\n\n    if (sanitizedPluginConfig.addresses) {\n      addressFields = sanitizedPluginConfig.addresses.addressFields\n\n      const supportedCountries = sanitizedPluginConfig.addresses.supportedCountries\n\n      const defaultAddressesCollection = createAddressesCollection({\n        access: accessConfig,\n        addressFields,\n        customersSlug: collectionSlugMap.customers,\n        supportedCountries,\n      })\n\n      const addressesCollection =\n        sanitizedPluginConfig.addresses &&\n        typeof sanitizedPluginConfig.addresses === 'object' &&\n        'addressesCollectionOverride' in sanitizedPluginConfig.addresses &&\n        sanitizedPluginConfig.addresses.addressesCollectionOverride\n          ? await sanitizedPluginConfig.addresses.addressesCollectionOverride({\n              defaultCollection: defaultAddressesCollection,\n            })\n          : defaultAddressesCollection\n\n      incomingConfig.collections.push(addressesCollection)\n    }\n\n    if (sanitizedPluginConfig.products) {\n      const productsConfig =\n        typeof sanitizedPluginConfig.products === 'boolean'\n          ? {\n              variants: true,\n            }\n          : sanitizedPluginConfig.products\n\n      enableVariants = Boolean(productsConfig.variants)\n\n      if (productsConfig.variants) {\n        const variantsConfig =\n          typeof productsConfig.variants === 'boolean' ? undefined : productsConfig.variants\n\n        const defaultVariantsCollection = createVariantsCollection({\n          access: accessConfig,\n          currenciesConfig,\n          inventory: sanitizedPluginConfig.inventory,\n          productsSlug: collectionSlugMap.products,\n          variantOptionsSlug: collectionSlugMap.variantOptions,\n          variantTypesSlug: collectionSlugMap.variantTypes,\n        })\n\n        const variants =\n          variantsConfig &&\n          typeof variantsConfig === 'object' &&\n          'variantsCollectionOverride' in variantsConfig &&\n          variantsConfig.variantsCollectionOverride\n            ? await variantsConfig.variantsCollectionOverride({\n                defaultCollection: defaultVariantsCollection,\n              })\n            : defaultVariantsCollection\n\n        const defaultVariantTypesCollection = createVariantTypesCollection({\n          access: accessConfig,\n          variantOptionsSlug: collectionSlugMap.variantOptions,\n        })\n\n        const variantTypes =\n          variantsConfig &&\n          typeof variantsConfig === 'object' &&\n          'variantTypesCollectionOverride' in variantsConfig &&\n          variantsConfig.variantTypesCollectionOverride\n            ? await variantsConfig.variantTypesCollectionOverride({\n                defaultCollection: defaultVariantTypesCollection,\n              })\n            : defaultVariantTypesCollection\n\n        const defaultVariantOptionsCollection = createVariantOptionsCollection({\n          access: accessConfig,\n          variantTypesSlug: collectionSlugMap.variantTypes,\n        })\n\n        const variantOptions =\n          variantsConfig &&\n          typeof variantsConfig === 'object' &&\n          'variantOptionsCollectionOverride' in variantsConfig &&\n          variantsConfig.variantOptionsCollectionOverride\n            ? await variantsConfig.variantOptionsCollectionOverride({\n                defaultCollection: defaultVariantOptionsCollection,\n              })\n            : defaultVariantOptionsCollection\n\n        incomingConfig.collections.push(variants, variantTypes, variantOptions)\n      }\n\n      const defaultProductsCollection = createProductsCollection({\n        access: accessConfig,\n        currenciesConfig,\n        enableVariants,\n        inventory: sanitizedPluginConfig.inventory,\n        variantsSlug: collectionSlugMap.variants,\n        variantTypesSlug: collectionSlugMap.variantTypes,\n      })\n\n      const productsCollection =\n        productsConfig &&\n        'productsCollectionOverride' in productsConfig &&\n        productsConfig.productsCollectionOverride\n          ? await productsConfig.productsCollectionOverride({\n              defaultCollection: defaultProductsCollection,\n            })\n          : defaultProductsCollection\n\n      incomingConfig.collections.push(productsCollection)\n\n      if (sanitizedPluginConfig.carts) {\n        const cartsConfig =\n          typeof sanitizedPluginConfig.carts === 'object' ? sanitizedPluginConfig.carts : {}\n\n        const defaultCartsCollection = createCartsCollection({\n          access: accessConfig,\n          allowGuestCarts: cartsConfig.allowGuestCarts,\n          cartItemMatcher: cartsConfig.cartItemMatcher,\n          currenciesConfig,\n          customersSlug: collectionSlugMap.customers,\n          enableVariants: Boolean(productsConfig.variants),\n          multiTenant: cartsConfig.multiTenant,\n          productsSlug: collectionSlugMap.products,\n          variantsSlug: collectionSlugMap.variants,\n        })\n\n        const cartsCollection =\n          sanitizedPluginConfig.carts &&\n          typeof sanitizedPluginConfig.carts === 'object' &&\n          'cartsCollectionOverride' in sanitizedPluginConfig.carts &&\n          sanitizedPluginConfig.carts.cartsCollectionOverride\n            ? await sanitizedPluginConfig.carts.cartsCollectionOverride({\n                defaultCollection: defaultCartsCollection,\n              })\n            : defaultCartsCollection\n\n        incomingConfig.collections.push(cartsCollection)\n      }\n    }\n\n    if (sanitizedPluginConfig.orders) {\n      const defaultOrdersCollection = createOrdersCollection({\n        access: accessConfig,\n        addressFields,\n        currenciesConfig,\n        customersSlug: collectionSlugMap.customers,\n        enableVariants,\n        productsSlug: collectionSlugMap.products,\n        variantsSlug: collectionSlugMap.variants,\n      })\n\n      const ordersCollection =\n        sanitizedPluginConfig.orders &&\n        typeof sanitizedPluginConfig.orders === 'object' &&\n        'ordersCollectionOverride' in sanitizedPluginConfig.orders &&\n        sanitizedPluginConfig.orders.ordersCollectionOverride\n          ? await sanitizedPluginConfig.orders.ordersCollectionOverride({\n              defaultCollection: defaultOrdersCollection,\n            })\n          : defaultOrdersCollection\n\n      incomingConfig.collections.push(ordersCollection)\n    }\n\n    const paymentMethods = sanitizedPluginConfig.payments.paymentMethods\n\n    if (sanitizedPluginConfig.payments) {\n      if (paymentMethods.length) {\n        if (!Array.isArray(incomingConfig.endpoints)) {\n          incomingConfig.endpoints = []\n        }\n\n        const productsValidation =\n          (typeof sanitizedPluginConfig.products === 'object' &&\n            sanitizedPluginConfig.products.validation) ||\n          undefined\n\n        paymentMethods.forEach((paymentMethod) => {\n          const methodPath = `/payments/${paymentMethod.name}`\n          const endpoints: Endpoint[] = []\n\n          const initiatePayment: Endpoint = {\n            handler: initiatePaymentHandler({\n              currenciesConfig,\n              inventory: sanitizedPluginConfig.inventory,\n              paymentMethod,\n              productsSlug: collectionSlugMap.products,\n              productsValidation,\n              transactionsSlug: collectionSlugMap.transactions,\n              variantsSlug: collectionSlugMap.variants,\n            }),\n            method: 'post',\n            path: `${methodPath}/initiate`,\n          }\n\n          const confirmOrder: Endpoint = {\n            handler: confirmOrderHandler({\n              cartsSlug: collectionSlugMap.carts,\n              currenciesConfig,\n              ordersSlug: collectionSlugMap.orders,\n              paymentMethod,\n              productsValidation,\n              transactionsSlug: collectionSlugMap.transactions,\n            }),\n            method: 'post',\n            path: `${methodPath}/confirm-order`,\n          }\n\n          endpoints.push(initiatePayment, confirmOrder)\n\n          // Attach any additional endpoints defined in the payment method\n          if (paymentMethod.endpoints && paymentMethod.endpoints.length > 0) {\n            const methodEndpoints = paymentMethod.endpoints.map((endpoint) => {\n              const path = endpoint.path.startsWith('/') ? endpoint.path : `/${endpoint.path}`\n\n              return {\n                ...endpoint,\n                path: `${methodPath}${path}`,\n              }\n            })\n\n            endpoints.push(...methodEndpoints)\n          }\n\n          incomingConfig.endpoints!.push(...endpoints)\n        })\n      }\n    }\n\n    if (sanitizedPluginConfig.transactions) {\n      // Get transactions config object (or empty if just boolean true)\n      const transactionsConfig =\n        typeof sanitizedPluginConfig.transactions === 'object'\n          ? sanitizedPluginConfig.transactions\n          : {}\n\n      // Get carts config for fallback multiTenant setting\n      const cartsConfig =\n        typeof sanitizedPluginConfig.carts === 'object' ? sanitizedPluginConfig.carts : {}\n\n      // Use transactions.multiTenant if specified, otherwise fall back to carts.multiTenant\n      const transactionsMultiTenant = transactionsConfig.multiTenant ?? cartsConfig.multiTenant\n\n      const defaultTransactionsCollection = createTransactionsCollection({\n        access: accessConfig,\n        addressFields,\n        cartsSlug: collectionSlugMap.carts,\n        currenciesConfig,\n        customersSlug: collectionSlugMap.customers,\n        enableVariants,\n        multiTenant: transactionsMultiTenant,\n        ordersSlug: collectionSlugMap.orders,\n        paymentMethods,\n        productsSlug: collectionSlugMap.products,\n        variantsSlug: collectionSlugMap.variants,\n      })\n\n      const transactionsCollection =\n        sanitizedPluginConfig.transactions &&\n        typeof sanitizedPluginConfig.transactions === 'object' &&\n        'transactionsCollectionOverride' in sanitizedPluginConfig.transactions &&\n        sanitizedPluginConfig.transactions.transactionsCollectionOverride\n          ? await sanitizedPluginConfig.transactions.transactionsCollectionOverride({\n              defaultCollection: defaultTransactionsCollection,\n            })\n          : defaultTransactionsCollection\n\n      incomingConfig.collections.push(transactionsCollection)\n    }\n\n    if (!incomingConfig.i18n) {\n      incomingConfig.i18n = {}\n    }\n\n    if (!incomingConfig.i18n?.translations) {\n      incomingConfig.i18n.translations = {}\n    }\n\n    incomingConfig.i18n.translations = deepMergeSimple(\n      translations,\n      incomingConfig.i18n?.translations,\n    )\n\n    if (!incomingConfig.typescript) {\n      incomingConfig.typescript = {}\n    }\n\n    if (!incomingConfig.typescript.schema) {\n      incomingConfig.typescript.schema = []\n    }\n\n    incomingConfig.typescript.schema.push((args) =>\n      pushTypeScriptProperties({\n        ...args,\n        collectionSlugMap,\n        sanitizedPluginConfig,\n      }),\n    )\n\n    return incomingConfig\n  }\n\nexport {\n  createAddressesCollection,\n  createCartsCollection,\n  createOrdersCollection,\n  createProductsCollection,\n  createTransactionsCollection,\n  createVariantOptionsCollection,\n  createVariantsCollection,\n  createVariantTypesCollection,\n}\n\nexport { EUR, GBP, USD } from './currencies/index.js'\nexport { amountField } from './fields/amountField.js'\nexport { currencyField } from './fields/currencyField.js'\nexport { pricesField } from './fields/pricesField.js'\nexport { statusField } from './fields/statusField.js'\nexport { variantsFields } from './fields/variantsFields.js'\n\n// Cart operations - server-side functions for cart manipulation\nexport { addItem } from './collections/carts/operations/addItem.js'\nexport { clearCart } from './collections/carts/operations/clearCart.js'\nexport { defaultCartItemMatcher } from './collections/carts/operations/defaultCartItemMatcher.js'\nexport { mergeCart } from './collections/carts/operations/mergeCart.js'\nexport { removeItem } from './collections/carts/operations/removeItem.js'\nexport { updateItem } from './collections/carts/operations/updateItem.js'\nexport type {\n  AddItemArgs,\n  CartItemData,\n  CartItemMatcher,\n  CartItemMatcherArgs,\n  CartOperationResult,\n  ClearCartArgs,\n  NewCartItem,\n  RemoveItemArgs,\n  UpdateItemArgs,\n} from './collections/carts/operations/types.js'\n"],"names":["deepMergeSimple","createAddressesCollection","createCartsCollection","createOrdersCollection","createProductsCollection","createTransactionsCollection","createVariantOptionsCollection","createVariantsCollection","createVariantTypesCollection","confirmOrderHandler","initiatePaymentHandler","translations","getCollectionSlugMap","pushTypeScriptProperties","sanitizePluginConfig","ecommercePlugin","pluginConfig","incomingConfig","sanitizedPluginConfig","collectionSlugMap","accessConfig","access","collections","enableVariants","currenciesConfig","currencies","addressFields","addresses","supportedCountries","defaultAddressesCollection","customersSlug","customers","addressesCollection","addressesCollectionOverride","defaultCollection","push","products","productsConfig","variants","Boolean","variantsConfig","undefined","defaultVariantsCollection","inventory","productsSlug","variantOptionsSlug","variantOptions","variantTypesSlug","variantTypes","variantsCollectionOverride","defaultVariantTypesCollection","variantTypesCollectionOverride","defaultVariantOptionsCollection","variantOptionsCollectionOverride","defaultProductsCollection","variantsSlug","productsCollection","productsCollectionOverride","carts","cartsConfig","defaultCartsCollection","allowGuestCarts","cartItemMatcher","multiTenant","cartsCollection","cartsCollectionOverride","orders","defaultOrdersCollection","ordersCollection","ordersCollectionOverride","paymentMethods","payments","length","Array","isArray","endpoints","productsValidation","validation","forEach","paymentMethod","methodPath","name","initiatePayment","handler","transactionsSlug","transactions","method","path","confirmOrder","cartsSlug","ordersSlug","methodEndpoints","map","endpoint","startsWith","transactionsConfig","transactionsMultiTenant","defaultTransactionsCollection","transactionsCollection","transactionsCollectionOverride","i18n","typescript","schema","args","EUR","GBP","USD","amountField","currencyField","pricesField","statusField","variantsFields","addItem","clearCart","defaultCartItemMatcher","mergeCart","removeItem","updateItem"],"mappings":"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"}