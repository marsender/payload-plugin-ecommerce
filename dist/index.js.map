{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import type { AcceptedLanguages } from '@payloadcms/translations'\nimport type { Config, Endpoint } from 'payload'\n\nimport type { PluginDefaultTranslationsObject } from './translations/types.js'\nimport type { EcommercePluginConfig, SanitizedEcommercePluginConfig } from './types/index.js'\n\nimport { createAddressesCollection } from './collections/addresses/createAddressesCollection.js'\nimport { createCartsCollection } from './collections/carts/createCartsCollection.js'\nimport { createOrdersCollection } from './collections/orders/createOrdersCollection.js'\nimport { createProductsCollection } from './collections/products/createProductsCollection.js'\nimport { createTransactionsCollection } from './collections/transactions/createTransactionsCollection.js'\nimport { createVariantOptionsCollection } from './collections/variants/createVariantOptionsCollection.js'\nimport { createVariantsCollection } from './collections/variants/createVariantsCollection/index.js'\nimport { createVariantTypesCollection } from './collections/variants/createVariantTypesCollection.js'\nimport { confirmOrderHandler } from './endpoints/confirmOrder.js'\nimport { initiatePaymentHandler } from './endpoints/initiatePayment.js'\nimport { translations } from './translations/index.js'\nimport { getCollectionSlugMap } from './utilities/getCollectionSlugMap.js'\nimport { pushTypeScriptProperties } from './utilities/pushTypeScriptProperties.js'\nimport { sanitizePluginConfig } from './utilities/sanitizePluginConfig.js'\n\nexport const ecommercePlugin =\n  (pluginConfig?: EcommercePluginConfig) =>\n  async (incomingConfig: Config): Promise<Config> => {\n    if (!pluginConfig) {\n      return incomingConfig\n    }\n\n    const sanitizedPluginConfig = sanitizePluginConfig({ pluginConfig })\n\n    const accessConfig = sanitizedPluginConfig.access\n\n    // Ensure collections exists\n    if (!incomingConfig.collections) {\n      incomingConfig.collections = []\n    }\n\n    // Determine if variants are enabled based on products config\n    const productsConfig =\n      typeof sanitizedPluginConfig.products === 'boolean'\n        ? sanitizedPluginConfig.products\n          ? { variants: true }\n          : undefined\n        : sanitizedPluginConfig.products\n\n    const enableVariants = Boolean(productsConfig?.variants)\n\n    /**\n     * Used to keep track of the slugs of collections in case they are overridden by the user.\n     * Variant-related slugs are only included when variants are enabled.\n     */\n    const collectionSlugMap = getCollectionSlugMap({ enableVariants, sanitizedPluginConfig })\n\n    const currenciesConfig: Required<SanitizedEcommercePluginConfig['currencies']> =\n      sanitizedPluginConfig.currencies\n\n    let addressFields\n\n    if (sanitizedPluginConfig.addresses) {\n      addressFields = sanitizedPluginConfig.addresses.addressFields\n\n      const supportedCountries = sanitizedPluginConfig.addresses.supportedCountries\n\n      const defaultAddressesCollection = createAddressesCollection({\n        access: accessConfig,\n        addressFields,\n        customersSlug: collectionSlugMap.customers,\n        supportedCountries,\n      })\n\n      const addressesCollection =\n        sanitizedPluginConfig.addresses &&\n        typeof sanitizedPluginConfig.addresses === 'object' &&\n        'addressesCollectionOverride' in sanitizedPluginConfig.addresses &&\n        sanitizedPluginConfig.addresses.addressesCollectionOverride\n          ? await sanitizedPluginConfig.addresses.addressesCollectionOverride({\n              defaultCollection: defaultAddressesCollection,\n            })\n          : defaultAddressesCollection\n\n      incomingConfig.collections.push(addressesCollection)\n    }\n\n    if (productsConfig) {\n      // Compute variantsMultiTenant outside the variants block so it's accessible by createProductsCollection\n      const variantsConfig =\n        typeof productsConfig.variants === 'boolean' ? undefined : productsConfig.variants\n\n      // Get carts config for fallback multiTenant setting (same pattern as transactions)\n      const cartsConfig =\n        typeof sanitizedPluginConfig.carts === 'object' ? sanitizedPluginConfig.carts : {}\n\n      // Use variants.multiTenant if specified, otherwise fall back to carts.multiTenant\n      const variantsMultiTenant = variantsConfig?.multiTenant ?? cartsConfig.multiTenant\n\n      if (productsConfig.variants) {\n\n        const defaultVariantsCollection = createVariantsCollection({\n          access: accessConfig,\n          currenciesConfig,\n          inventory: sanitizedPluginConfig.inventory,\n          multiTenant: variantsMultiTenant,\n          productsSlug: collectionSlugMap.products,\n          variantOptionsSlug: collectionSlugMap.variantOptions ?? 'variantOptions',\n          variantTypesSlug: collectionSlugMap.variantTypes ?? 'variantTypes',\n        })\n\n        const variants =\n          variantsConfig &&\n          typeof variantsConfig === 'object' &&\n          'variantsCollectionOverride' in variantsConfig &&\n          variantsConfig.variantsCollectionOverride\n            ? await variantsConfig.variantsCollectionOverride({\n                defaultCollection: defaultVariantsCollection,\n              })\n            : defaultVariantsCollection\n\n        const defaultVariantTypesCollection = createVariantTypesCollection({\n          access: accessConfig,\n          multiTenant: variantsMultiTenant,\n          variantOptionsSlug: collectionSlugMap.variantOptions ?? 'variantOptions',\n        })\n\n        const variantTypes =\n          variantsConfig &&\n          typeof variantsConfig === 'object' &&\n          'variantTypesCollectionOverride' in variantsConfig &&\n          variantsConfig.variantTypesCollectionOverride\n            ? await variantsConfig.variantTypesCollectionOverride({\n                defaultCollection: defaultVariantTypesCollection,\n              })\n            : defaultVariantTypesCollection\n\n        const defaultVariantOptionsCollection = createVariantOptionsCollection({\n          access: accessConfig,\n          multiTenant: variantsMultiTenant,\n          variantTypesSlug: collectionSlugMap.variantTypes ?? 'variantTypes',\n        })\n\n        const variantOptions =\n          variantsConfig &&\n          typeof variantsConfig === 'object' &&\n          'variantOptionsCollectionOverride' in variantsConfig &&\n          variantsConfig.variantOptionsCollectionOverride\n            ? await variantsConfig.variantOptionsCollectionOverride({\n                defaultCollection: defaultVariantOptionsCollection,\n              })\n            : defaultVariantOptionsCollection\n\n        incomingConfig.collections.push(variants, variantTypes, variantOptions)\n      }\n\n      const defaultProductsCollection = createProductsCollection({\n        access: accessConfig,\n        currenciesConfig,\n        enableVariants,\n        inventory: sanitizedPluginConfig.inventory,\n        multiTenant: variantsMultiTenant,\n        variantsSlug: collectionSlugMap.variants,\n        variantTypesSlug: collectionSlugMap.variantTypes,\n      })\n\n      const productsCollection =\n        productsConfig &&\n        'productsCollectionOverride' in productsConfig &&\n        productsConfig.productsCollectionOverride\n          ? await productsConfig.productsCollectionOverride({\n              defaultCollection: defaultProductsCollection,\n            })\n          : defaultProductsCollection\n\n      incomingConfig.collections.push(productsCollection)\n\n      if (sanitizedPluginConfig.carts) {\n        const cartsConfig =\n          typeof sanitizedPluginConfig.carts === 'object' ? sanitizedPluginConfig.carts : {}\n\n        const defaultCartsCollection = createCartsCollection({\n          access: accessConfig,\n          allowGuestCarts: cartsConfig.allowGuestCarts,\n          cartItemMatcher: cartsConfig.cartItemMatcher,\n          currenciesConfig,\n          customersSlug: collectionSlugMap.customers,\n          enableVariants: Boolean(productsConfig.variants),\n          multiTenant: cartsConfig.multiTenant,\n          productsSlug: collectionSlugMap.products,\n          variantsSlug: collectionSlugMap.variants,\n        })\n\n        const cartsCollection =\n          sanitizedPluginConfig.carts &&\n          typeof sanitizedPluginConfig.carts === 'object' &&\n          'cartsCollectionOverride' in sanitizedPluginConfig.carts &&\n          sanitizedPluginConfig.carts.cartsCollectionOverride\n            ? await sanitizedPluginConfig.carts.cartsCollectionOverride({\n                defaultCollection: defaultCartsCollection,\n              })\n            : defaultCartsCollection\n\n        incomingConfig.collections.push(cartsCollection)\n      }\n    }\n\n    if (sanitizedPluginConfig.orders) {\n      const defaultOrdersCollection = createOrdersCollection({\n        access: accessConfig,\n        addressFields,\n        currenciesConfig,\n        customersSlug: collectionSlugMap.customers,\n        enableVariants,\n        productsSlug: collectionSlugMap.products,\n        variantsSlug: collectionSlugMap.variants,\n      })\n\n      const ordersCollection =\n        sanitizedPluginConfig.orders &&\n        typeof sanitizedPluginConfig.orders === 'object' &&\n        'ordersCollectionOverride' in sanitizedPluginConfig.orders &&\n        sanitizedPluginConfig.orders.ordersCollectionOverride\n          ? await sanitizedPluginConfig.orders.ordersCollectionOverride({\n              defaultCollection: defaultOrdersCollection,\n            })\n          : defaultOrdersCollection\n\n      incomingConfig.collections.push(ordersCollection)\n    }\n\n    const paymentMethods = sanitizedPluginConfig.payments.paymentMethods\n\n    if (sanitizedPluginConfig.payments) {\n      if (paymentMethods.length) {\n        if (!Array.isArray(incomingConfig.endpoints)) {\n          incomingConfig.endpoints = []\n        }\n\n        const productsValidation =\n          (typeof sanitizedPluginConfig.products === 'object' &&\n            sanitizedPluginConfig.products.validation) ||\n          undefined\n\n        paymentMethods.forEach((paymentMethod) => {\n          const methodPath = `/payments/${paymentMethod.name}`\n          const endpoints: Endpoint[] = []\n\n          const initiatePayment: Endpoint = {\n            handler: initiatePaymentHandler({\n              currenciesConfig,\n              inventory: sanitizedPluginConfig.inventory,\n              paymentMethod,\n              productsSlug: collectionSlugMap.products,\n              productsValidation,\n              transactionsSlug: collectionSlugMap.transactions,\n              variantsSlug: collectionSlugMap.variants,\n            }),\n            method: 'post',\n            path: `${methodPath}/initiate`,\n          }\n\n          const confirmOrder: Endpoint = {\n            handler: confirmOrderHandler({\n              cartsSlug: collectionSlugMap.carts,\n              currenciesConfig,\n              ordersSlug: collectionSlugMap.orders,\n              paymentMethod,\n              productsSlug: collectionSlugMap.products,\n              productsValidation,\n              transactionsSlug: collectionSlugMap.transactions,\n              variantsSlug: collectionSlugMap.variants ?? 'variants',\n            }),\n            method: 'post',\n            path: `${methodPath}/confirm-order`,\n          }\n\n          endpoints.push(initiatePayment, confirmOrder)\n\n          // Attach any additional endpoints defined in the payment method\n          if (paymentMethod.endpoints && paymentMethod.endpoints.length > 0) {\n            const methodEndpoints = paymentMethod.endpoints.map((endpoint) => {\n              const path = endpoint.path.startsWith('/') ? endpoint.path : `/${endpoint.path}`\n\n              return {\n                ...endpoint,\n                path: `${methodPath}${path}`,\n              }\n            })\n\n            endpoints.push(...methodEndpoints)\n          }\n\n          incomingConfig.endpoints!.push(...endpoints)\n        })\n      }\n    }\n\n    if (sanitizedPluginConfig.transactions) {\n      // Get transactions config object (or empty if just boolean true)\n      const transactionsConfig =\n        typeof sanitizedPluginConfig.transactions === 'object'\n          ? sanitizedPluginConfig.transactions\n          : {}\n\n      // Get carts config for fallback multiTenant setting\n      const cartsConfig =\n        typeof sanitizedPluginConfig.carts === 'object' ? sanitizedPluginConfig.carts : {}\n\n      // Use transactions.multiTenant if specified, otherwise fall back to carts.multiTenant\n      const transactionsMultiTenant = transactionsConfig.multiTenant ?? cartsConfig.multiTenant\n\n      const defaultTransactionsCollection = createTransactionsCollection({\n        access: accessConfig,\n        addressFields,\n        cartsSlug: collectionSlugMap.carts,\n        currenciesConfig,\n        customersSlug: collectionSlugMap.customers,\n        enableVariants,\n        multiTenant: transactionsMultiTenant,\n        ordersSlug: collectionSlugMap.orders,\n        paymentMethods,\n        productsSlug: collectionSlugMap.products,\n        variantsSlug: collectionSlugMap.variants,\n      })\n\n      const transactionsCollection =\n        sanitizedPluginConfig.transactions &&\n        typeof sanitizedPluginConfig.transactions === 'object' &&\n        'transactionsCollectionOverride' in sanitizedPluginConfig.transactions &&\n        sanitizedPluginConfig.transactions.transactionsCollectionOverride\n          ? await sanitizedPluginConfig.transactions.transactionsCollectionOverride({\n              defaultCollection: defaultTransactionsCollection,\n            })\n          : defaultTransactionsCollection\n\n      incomingConfig.collections.push(transactionsCollection)\n    }\n\n    /**\n     * Merge plugin translations\n     */\n    if (!incomingConfig.i18n) {\n      incomingConfig.i18n = {}\n    }\n    Object.entries(translations).forEach(([locale, pluginI18nObject]) => {\n      const typedLocale = locale as AcceptedLanguages\n      if (!incomingConfig.i18n!.translations) {\n        incomingConfig.i18n!.translations = {}\n      }\n      if (!(typedLocale in incomingConfig.i18n!.translations)) {\n        incomingConfig.i18n!.translations[typedLocale] = {}\n      }\n      if (!('plugin-ecommerce' in incomingConfig.i18n!.translations[typedLocale]!)) {\n        ;(incomingConfig.i18n!.translations[typedLocale] as PluginDefaultTranslationsObject)[\n          'plugin-ecommerce'\n        ] = {} as PluginDefaultTranslationsObject['plugin-ecommerce']\n      }\n\n      ;(incomingConfig.i18n!.translations[typedLocale] as PluginDefaultTranslationsObject)[\n        'plugin-ecommerce'\n      ] = {\n        ...pluginI18nObject.translations['plugin-ecommerce'],\n      }\n    })\n\n    if (!incomingConfig.typescript) {\n      incomingConfig.typescript = {}\n    }\n\n    if (!incomingConfig.typescript.schema) {\n      incomingConfig.typescript.schema = []\n    }\n\n    incomingConfig.typescript.schema.push((args) =>\n      pushTypeScriptProperties({\n        ...args,\n        collectionSlugMap,\n        sanitizedPluginConfig,\n      }),\n    )\n\n    return incomingConfig\n  }\n\nexport {\n  createAddressesCollection,\n  createCartsCollection,\n  createOrdersCollection,\n  createProductsCollection,\n  createTransactionsCollection,\n  createVariantOptionsCollection,\n  createVariantsCollection,\n  createVariantTypesCollection,\n}\n\nexport { EUR, GBP, USD } from './currencies/index.js'\nexport { amountField } from './fields/amountField.js'\nexport { currencyField } from './fields/currencyField.js'\nexport { pricesField } from './fields/pricesField.js'\nexport { statusField } from './fields/statusField.js'\nexport { variantsFields } from './fields/variantsFields.js'\n\n// Cart operations - server-side functions for cart manipulation\nexport { addItem } from './collections/carts/operations/addItem.js'\nexport { clearCart } from './collections/carts/operations/clearCart.js'\nexport { defaultCartItemMatcher } from './collections/carts/operations/defaultCartItemMatcher.js'\nexport { mergeCart } from './collections/carts/operations/mergeCart.js'\nexport { removeItem } from './collections/carts/operations/removeItem.js'\nexport { updateItem } from './collections/carts/operations/updateItem.js'\nexport { isNumericOperator } from './collections/carts/operations/types.js'\nexport type {\n  AddItemArgs,\n  CartItemData,\n  CartItemMatcher,\n  CartItemMatcherArgs,\n  CartOperationResult,\n  ClearCartArgs,\n  FieldWithOperator,\n  NewCartItem,\n  NumericOperator,\n  RemoveItemArgs,\n  UpdateItemArgs,\n} from './collections/carts/operations/types.js'\n"],"names":["createAddressesCollection","createCartsCollection","createOrdersCollection","createProductsCollection","createTransactionsCollection","createVariantOptionsCollection","createVariantsCollection","createVariantTypesCollection","confirmOrderHandler","initiatePaymentHandler","translations","getCollectionSlugMap","pushTypeScriptProperties","sanitizePluginConfig","ecommercePlugin","pluginConfig","incomingConfig","sanitizedPluginConfig","accessConfig","access","collections","productsConfig","products","variants","undefined","enableVariants","Boolean","collectionSlugMap","currenciesConfig","currencies","addressFields","addresses","supportedCountries","defaultAddressesCollection","customersSlug","customers","addressesCollection","addressesCollectionOverride","defaultCollection","push","variantsConfig","cartsConfig","carts","variantsMultiTenant","multiTenant","defaultVariantsCollection","inventory","productsSlug","variantOptionsSlug","variantOptions","variantTypesSlug","variantTypes","variantsCollectionOverride","defaultVariantTypesCollection","variantTypesCollectionOverride","defaultVariantOptionsCollection","variantOptionsCollectionOverride","defaultProductsCollection","variantsSlug","productsCollection","productsCollectionOverride","defaultCartsCollection","allowGuestCarts","cartItemMatcher","cartsCollection","cartsCollectionOverride","orders","defaultOrdersCollection","ordersCollection","ordersCollectionOverride","paymentMethods","payments","length","Array","isArray","endpoints","productsValidation","validation","forEach","paymentMethod","methodPath","name","initiatePayment","handler","transactionsSlug","transactions","method","path","confirmOrder","cartsSlug","ordersSlug","methodEndpoints","map","endpoint","startsWith","transactionsConfig","transactionsMultiTenant","defaultTransactionsCollection","transactionsCollection","transactionsCollectionOverride","i18n","Object","entries","locale","pluginI18nObject","typedLocale","typescript","schema","args","EUR","GBP","USD","amountField","currencyField","pricesField","statusField","variantsFields","addItem","clearCart","defaultCartItemMatcher","mergeCart","removeItem","updateItem","isNumericOperator"],"mappings":"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"}