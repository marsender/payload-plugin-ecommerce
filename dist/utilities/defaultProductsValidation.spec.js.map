{"version":3,"sources":["../../src/utilities/defaultProductsValidation.spec.ts"],"sourcesContent":["import type { CurrenciesConfig } from '../types/index.js'\n\nimport { EUR, USD } from '../currencies/index.js'\nimport { defaultProductsValidation } from './defaultProductsValidation'\nimport { MissingPrice, OutOfStock } from './errorCodes'\n\ndescribe('defaultProductsValidation', () => {\n  const currenciesConfig: CurrenciesConfig = {\n    defaultCurrency: 'USD',\n    supportedCurrencies: [USD, EUR],\n  }\n\n  describe('currency validation', () => {\n    it('should throw error when currency is not provided', () => {\n      const product = {\n        id: 'product-1',\n        priceInUSD: 1000,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: '',\n          product: product as any,\n          quantity: 1,\n        })\n      }).toThrow('Currency must be provided for product validation.')\n    })\n\n    it('should throw error when currency is undefined', () => {\n      const product = {\n        id: 'product-1',\n        priceInUSD: 1000,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: undefined as any,\n          product: product as any,\n          quantity: 1,\n        })\n      }).toThrow('Currency must be provided for product validation.')\n    })\n  })\n\n  describe('variant validation', () => {\n    it('should validate variant price exists', () => {\n      const variant = {\n        id: 'variant-1',\n        priceInEUR: 900,\n        inventory: 10,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: {} as any,\n          quantity: 1,\n          variant: variant as any,\n        })\n      }).toThrow('Variant with ID variant-1 does not have a price in usd.')\n    })\n\n    it('should pass when variant has price in requested currency', () => {\n      const variant = {\n        id: 'variant-1',\n        priceInUSD: 1000,\n        inventory: 10,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: {} as any,\n          quantity: 1,\n          variant: variant as any,\n        })\n      }).not.toThrow()\n    })\n\n    it('should handle case-insensitive currency codes', () => {\n      const variant = {\n        id: 'variant-1',\n        priceInUSD: 1000,\n        inventory: 10,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'USD',\n          product: {} as any,\n          quantity: 1,\n          variant: variant as any,\n        })\n      }).not.toThrow()\n    })\n\n    it('should throw error when variant inventory is 0', () => {\n      const variant = {\n        id: 'variant-1',\n        priceInUSD: 1000,\n        inventory: 0,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: {} as any,\n          quantity: 1,\n          variant: variant as any,\n        })\n      }).toThrow('Variant with ID variant-1 is out of stock or does not have enough inventory.')\n    })\n\n    it('should throw error when variant inventory is less than quantity', () => {\n      const variant = {\n        id: 'variant-1',\n        priceInUSD: 1000,\n        inventory: 5,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: {} as any,\n          quantity: 10,\n          variant: variant as any,\n        })\n      }).toThrow('Variant with ID variant-1 is out of stock or does not have enough inventory.')\n    })\n\n    it('should pass when variant inventory equals quantity', () => {\n      const variant = {\n        id: 'variant-1',\n        priceInUSD: 1000,\n        inventory: 5,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: {} as any,\n          quantity: 5,\n          variant: variant as any,\n        })\n      }).not.toThrow()\n    })\n\n    it('should pass when variant inventory is greater than quantity', () => {\n      const variant = {\n        id: 'variant-1',\n        priceInUSD: 1000,\n        inventory: 10,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: {} as any,\n          quantity: 5,\n          variant: variant as any,\n        })\n      }).not.toThrow()\n    })\n\n    it('should pass when variant has no inventory field (unlimited stock)', () => {\n      const variant = {\n        id: 'variant-1',\n        priceInUSD: 1000,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: {} as any,\n          quantity: 100,\n          variant: variant as any,\n        })\n      }).not.toThrow()\n    })\n  })\n\n  describe('product validation', () => {\n    it('should validate product price exists', () => {\n      const product = {\n        id: 'product-1',\n        priceInEUR: 900,\n        inventory: 10,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: product as any,\n          quantity: 1,\n        })\n      }).toThrow('Product does not have a price in.')\n    })\n\n    it('should include error cause with MissingPrice code', () => {\n      const product = {\n        id: 'product-1',\n        priceInEUR: 900,\n        inventory: 10,\n      }\n\n      try {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: product as any,\n          quantity: 1,\n        })\n      } catch (error: any) {\n        expect(error.cause).toEqual({\n          code: MissingPrice,\n          codes: ['product-1', 'usd'],\n        })\n      }\n    })\n\n    it('should pass when product has price in requested currency', () => {\n      const product = {\n        id: 'product-1',\n        priceInUSD: 1000,\n        inventory: 10,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: product as any,\n          quantity: 1,\n        })\n      }).not.toThrow()\n    })\n\n    it('should throw error when product inventory is 0', () => {\n      const product = {\n        id: 'product-1',\n        priceInUSD: 1000,\n        inventory: 0,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: product as any,\n          quantity: 1,\n        })\n      }).toThrow('Product is out of stock or does not have enough inventory.')\n    })\n\n    it('should include error cause with OutOfStock code', () => {\n      const product = {\n        id: 'product-1',\n        priceInUSD: 1000,\n        inventory: 0,\n      }\n\n      try {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: product as any,\n          quantity: 1,\n        })\n      } catch (error: any) {\n        expect(error.cause).toEqual({\n          code: OutOfStock,\n          codes: ['product-1'],\n        })\n      }\n    })\n\n    it('should throw error when product inventory is less than quantity', () => {\n      const product = {\n        id: 'product-1',\n        priceInUSD: 1000,\n        inventory: 5,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: product as any,\n          quantity: 10,\n        })\n      }).toThrow('Product is out of stock or does not have enough inventory.')\n    })\n\n    it('should pass when product inventory equals quantity', () => {\n      const product = {\n        id: 'product-1',\n        priceInUSD: 1000,\n        inventory: 5,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: product as any,\n          quantity: 5,\n        })\n      }).not.toThrow()\n    })\n\n    it('should pass when product inventory is greater than quantity', () => {\n      const product = {\n        id: 'product-1',\n        priceInUSD: 1000,\n        inventory: 10,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: product as any,\n          quantity: 5,\n        })\n      }).not.toThrow()\n    })\n\n    it('should pass when product has no inventory field (unlimited stock)', () => {\n      const product = {\n        id: 'product-1',\n        priceInUSD: 1000,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: product as any,\n          quantity: 100,\n        })\n      }).not.toThrow()\n    })\n\n    it('should default quantity to 1 when not provided', () => {\n      const product = {\n        id: 'product-1',\n        priceInUSD: 1000,\n        inventory: 1,\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: product as any,\n        })\n      }).not.toThrow()\n    })\n  })\n\n  describe('variant priority over product', () => {\n    it('should only validate variant when both product and variant are provided', () => {\n      const product = {\n        id: 'product-1',\n        priceInEUR: 900, // Missing USD price\n        inventory: 0, // Out of stock\n      }\n\n      const variant = {\n        id: 'variant-1',\n        priceInUSD: 1000,\n        inventory: 10,\n      }\n\n      // Should not throw because variant validation takes priority\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: product as any,\n          quantity: 1,\n          variant: variant as any,\n        })\n      }).not.toThrow()\n    })\n\n    it('should not validate product inventory when variant is provided', () => {\n      const product = {\n        id: 'product-1',\n        priceInUSD: 1000,\n        inventory: 0, // Product out of stock\n      }\n\n      const variant = {\n        id: 'variant-1',\n        priceInUSD: 1000,\n        inventory: 10, // But variant has stock\n      }\n\n      expect(() => {\n        defaultProductsValidation({\n          currenciesConfig,\n          currency: 'usd',\n          product: product as any,\n          quantity: 1,\n          variant: variant as any,\n        })\n      }).not.toThrow()\n    })\n  })\n})\n"],"names":["EUR","USD","defaultProductsValidation","MissingPrice","OutOfStock","describe","currenciesConfig","defaultCurrency","supportedCurrencies","it","product","id","priceInUSD","expect","currency","quantity","toThrow","undefined","variant","priceInEUR","inventory","not","error","cause","toEqual","code","codes"],"mappings":"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"}