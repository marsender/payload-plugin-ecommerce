{"version":3,"sources":["../../../src/react/provider/index.tsx"],"sourcesContent":["'use client'\nimport type { DefaultDocumentIDType, TypedUser } from 'payload'\n\nimport { deepMergeSimple, formatAdminURL } from 'payload/shared'\nimport * as qs from 'qs-esm'\nimport React, {\n  createContext,\n  use,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n  useTransition,\n} from 'react'\n\nimport type {\n  AddressesCollection,\n  CartItem,\n  CartsCollection,\n  ContextProps,\n  Currency,\n  EcommerceContextType,\n} from '../../types/index.js'\n\nconst defaultContext: EcommerceContextType = {\n  addItem: async () => {},\n  clearCart: async () => {},\n  confirmOrder: async () => {},\n  createAddress: async () => {},\n  deleteAddress: async () => {},\n  currenciesConfig: {\n    defaultCurrency: 'USD',\n    supportedCurrencies: [\n      {\n        code: 'USD',\n        decimals: 2,\n        label: 'US Dollar',\n        symbol: '$',\n      },\n    ],\n  },\n  currency: {\n    code: 'USD',\n    decimals: 2,\n    label: 'US Dollar',\n    symbol: '$',\n  },\n  decrementItem: async () => {},\n  incrementItem: async () => {},\n  initiatePayment: async () => {},\n  isLoading: false,\n  paymentMethods: [],\n  refreshUser: async () => {},\n  removeItem: async () => {},\n  setCurrency: () => {},\n  updateAddress: async () => {},\n}\n\nconst EcommerceContext = createContext<EcommerceContextType>(defaultContext)\n\nconst defaultLocalStorage = {\n  key: 'cart',\n}\n\nexport const EcommerceProvider: React.FC<ContextProps> = ({\n  addressesSlug = 'addresses',\n  api,\n  cartsSlug = 'carts',\n  children,\n  currenciesConfig = {\n    defaultCurrency: 'USD',\n    supportedCurrencies: [\n      {\n        code: 'USD',\n        decimals: 2,\n        label: 'US Dollar',\n        symbol: '$',\n      },\n    ],\n  },\n  customersSlug = 'users',\n  debug = false,\n  paymentMethods = [],\n  syncLocalStorage = true,\n}) => {\n  const localStorageConfig =\n    syncLocalStorage && typeof syncLocalStorage === 'object'\n      ? {\n          ...defaultLocalStorage,\n          ...syncLocalStorage,\n        }\n      : defaultLocalStorage\n\n  const { apiRoute = '/api', cartsFetchQuery = {} } = api || {}\n  const baseAPIURL = formatAdminURL({\n    apiRoute,\n    path: '',\n  })\n\n  const [isLoading, startTransition] = useTransition()\n\n  const [user, setUser] = useState<null | TypedUser>(null)\n\n  const [addresses, setAddresses] = useState<AddressesCollection[]>()\n\n  const hasRendered = useRef(false)\n\n  /**\n   * The ID of the cart associated with the current session.\n   * This is used to identify the cart in the database or local storage.\n   * It can be null if no cart has been created yet.\n   */\n  const [cartID, setCartID] = useState<DefaultDocumentIDType>()\n  /**\n   * The secret for accessing guest carts without authentication.\n   * This is generated when a guest user creates a cart.\n   */\n  const [cartSecret, setCartSecret] = useState<string | undefined>(undefined)\n  const [cart, setCart] = useState<CartsCollection>()\n\n  const [selectedCurrency, setSelectedCurrency] = useState<Currency>(\n    () =>\n      currenciesConfig.supportedCurrencies.find(\n        (c) => c.code === currenciesConfig.defaultCurrency,\n      )!,\n  )\n\n  const [selectedPaymentMethod, setSelectedPaymentMethod] = useState<null | string>(null)\n\n  const cartQuery = useMemo(() => {\n    const priceField = `priceIn${selectedCurrency.code}`\n\n    const baseQuery = {\n      depth: 0,\n      populate: {\n        products: {\n          [priceField]: true,\n        },\n        variants: {\n          options: true,\n          [priceField]: true,\n        },\n      },\n      select: {\n        items: true,\n        subtotal: true,\n      },\n    }\n\n    return deepMergeSimple(baseQuery, cartsFetchQuery)\n  }, [selectedCurrency.code, cartsFetchQuery])\n\n  const createCart = useCallback(\n    async (initialData: Record<string, unknown>) => {\n      const query = qs.stringify(cartQuery)\n\n      const response = await fetch(`${baseAPIURL}/${cartsSlug}?${query}`, {\n        body: JSON.stringify({\n          ...initialData,\n          currency: selectedCurrency.code,\n          customer: user?.id,\n        }),\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        method: 'POST',\n      })\n\n      if (!response.ok) {\n        const errorText = await response.text()\n        throw new Error(`Failed to create cart: ${errorText}`)\n      }\n\n      const data = await response.json()\n\n      if (data.error) {\n        throw new Error(`Cart creation error: ${data.error}`)\n      }\n\n      // Store the secret for guest cart access\n      if (!user && data.doc?.secret) {\n        setCartSecret(data.doc.secret)\n      }\n\n      return data.doc as CartsCollection\n    },\n    [baseAPIURL, cartQuery, cartsSlug, selectedCurrency.code, user],\n  )\n\n  const getCart = useCallback(\n    async (cartID: DefaultDocumentIDType, options?: { secret?: string }) => {\n      const secret = options?.secret\n\n      // Build query params with secret if provided\n      const queryParams = {\n        ...cartQuery,\n        ...(secret ? { secret } : {}),\n      }\n      const query = qs.stringify(queryParams)\n\n      const response = await fetch(`${baseAPIURL}/${cartsSlug}/${cartID}?${query}`, {\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        method: 'GET',\n      })\n\n      if (!response.ok) {\n        const errorText = await response.text()\n        throw new Error(`Failed to fetch cart: ${errorText}`)\n      }\n\n      const data = await response.json()\n\n      if (data.error) {\n        throw new Error(`Cart fetch error: ${data.error}`)\n      }\n\n      return data as CartsCollection\n    },\n    [baseAPIURL, cartQuery, cartsSlug],\n  )\n\n  const updateCart = useCallback(\n    async (cartID: DefaultDocumentIDType, data: Partial<CartsCollection>) => {\n      // Build query params with secret if provided\n      const queryParams = {\n        ...cartQuery,\n        ...(cartSecret ? { secret: cartSecret } : {}),\n      }\n      const query = qs.stringify(queryParams)\n\n      const response = await fetch(`${baseAPIURL}/${cartsSlug}/${cartID}?${query}`, {\n        body: JSON.stringify(data),\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        method: 'PATCH',\n      })\n\n      if (!response.ok) {\n        const errorText = await response.text()\n        throw new Error(`Failed to update cart: ${errorText}`)\n      }\n\n      const updatedCart = await response.json()\n\n      setCart(updatedCart.doc as CartsCollection)\n    },\n    [baseAPIURL, cartQuery, cartsSlug, cartSecret],\n  )\n\n  const deleteCart = useCallback(\n    async (cartID: DefaultDocumentIDType) => {\n      // Build query params with secret if provided\n      const queryParams = cartSecret ? { secret: cartSecret } : {}\n      const query = qs.stringify(queryParams)\n      const url = `${baseAPIURL}/${cartsSlug}/${cartID}${query ? `?${query}` : ''}`\n\n      const response = await fetch(url, {\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        method: 'DELETE',\n      })\n\n      if (!response.ok) {\n        const errorText = await response.text()\n        throw new Error(`Failed to delete cart: ${errorText}`)\n      }\n\n      setCart(undefined)\n      setCartID(undefined)\n      setCartSecret(undefined)\n    },\n    [baseAPIURL, cartsSlug, cartSecret],\n  )\n\n  // Persist cart ID and secret to localStorage\n  useEffect(() => {\n    if (hasRendered.current) {\n      if (syncLocalStorage) {\n        if (cartID) {\n          localStorage.setItem(localStorageConfig.key, cartID as string)\n        } else {\n          localStorage.removeItem(localStorageConfig.key)\n        }\n\n        if (cartSecret) {\n          localStorage.setItem(`${localStorageConfig.key}_secret`, cartSecret)\n        } else {\n          localStorage.removeItem(`${localStorageConfig.key}_secret`)\n        }\n      }\n    }\n  }, [cartID, cartSecret, localStorageConfig.key, syncLocalStorage])\n\n  const addItem: EcommerceContextType['addItem'] = useCallback(\n    async (item, quantity = 1) => {\n      return new Promise<void>((resolve) => {\n        startTransition(async () => {\n          if (cartID) {\n            const existingCart = await getCart(cartID, { secret: cartSecret })\n\n            if (!existingCart) {\n              // console.error(`Cart with ID \"${cartID}\" not found`)\n\n              setCartID(undefined)\n              setCart(undefined)\n              return\n            }\n\n            // Check if the item already exists in the cart\n            const existingItemIndex =\n              existingCart.items?.findIndex((cartItem: CartItem) => {\n                const productID =\n                  typeof cartItem.product === 'object' ? cartItem.product.id : item.product\n                const variantID =\n                  cartItem.variant && typeof cartItem.variant === 'object'\n                    ? cartItem.variant.id\n                    : item.variant\n\n                return (\n                  productID === item.product &&\n                  (item.variant && variantID ? variantID === item.variant : true)\n                )\n              }) ?? -1\n\n            let updatedItems = existingCart.items ? [...existingCart.items] : []\n\n            if (existingItemIndex !== -1) {\n              // If the item exists, update its quantity\n              updatedItems[existingItemIndex].quantity =\n                updatedItems[existingItemIndex].quantity + quantity\n\n              // Update the cart with the new items\n              await updateCart(cartID, {\n                items: updatedItems,\n              })\n            } else {\n              // If the item does not exist, add it to the cart\n              updatedItems = [...(existingCart.items ?? []), { ...item, quantity }]\n            }\n\n            // Update the cart with the new items\n            await updateCart(cartID, {\n              items: updatedItems,\n            })\n          } else {\n            // If no cartID exists, create a new cart\n            const newCart = await createCart({ items: [{ ...item, quantity }] })\n\n            setCartID(newCart.id)\n            setCart(newCart)\n          }\n          resolve()\n        })\n      })\n    },\n    [cartID, cartSecret, createCart, getCart, startTransition, updateCart],\n  )\n\n  const removeItem: EcommerceContextType['removeItem'] = useCallback(\n    async (targetID) => {\n      return new Promise<void>((resolve) => {\n        startTransition(async () => {\n          if (!cartID) {\n            resolve()\n            return\n          }\n\n          const existingCart = await getCart(cartID, { secret: cartSecret })\n\n          if (!existingCart) {\n            // console.error(`Cart with ID \"${cartID}\" not found`)\n            setCartID(undefined)\n            setCart(undefined)\n            resolve()\n            return\n          }\n\n          // Check if the item already exists in the cart\n          const existingItemIndex =\n            existingCart.items?.findIndex((cartItem: CartItem) => cartItem.id === targetID) ?? -1\n\n          if (existingItemIndex !== -1) {\n            // If the item exists, remove it from the cart\n            const updatedItems = existingCart.items ? [...existingCart.items] : []\n            updatedItems.splice(existingItemIndex, 1)\n\n            // Update the cart with the new items\n            await updateCart(cartID, {\n              items: updatedItems,\n            })\n          }\n          resolve()\n        })\n      })\n    },\n    [cartID, cartSecret, getCart, startTransition, updateCart],\n  )\n\n  const incrementItem: EcommerceContextType['incrementItem'] = useCallback(\n    async (targetID) => {\n      return new Promise<void>((resolve) => {\n        startTransition(async () => {\n          if (!cartID) {\n            resolve()\n            return\n          }\n\n          const existingCart = await getCart(cartID, { secret: cartSecret })\n\n          if (!existingCart) {\n            // console.error(`Cart with ID \"${cartID}\" not found`)\n            setCartID(undefined)\n            setCart(undefined)\n            resolve()\n            return\n          }\n\n          // Check if the item already exists in the cart\n          const existingItemIndex =\n            existingCart.items?.findIndex((cartItem: CartItem) => cartItem.id === targetID) ?? -1\n\n          let updatedItems = existingCart.items ? [...existingCart.items] : []\n\n          if (existingItemIndex !== -1) {\n            // If the item exists, increment its quantity\n            updatedItems[existingItemIndex].quantity = updatedItems[existingItemIndex].quantity + 1 // Increment by 1\n            // Update the cart with the new items\n            await updateCart(cartID, {\n              items: updatedItems,\n            })\n          } else {\n            // If the item does not exist, add it to the cart with quantity 1\n            updatedItems = [...(existingCart.items ?? []), { product: targetID, quantity: 1 }]\n            // Update the cart with the new items\n            await updateCart(cartID, {\n              items: updatedItems,\n            })\n          }\n          resolve()\n        })\n      })\n    },\n    [cartID, cartSecret, getCart, startTransition, updateCart],\n  )\n\n  const decrementItem: EcommerceContextType['decrementItem'] = useCallback(\n    async (targetID) => {\n      return new Promise<void>((resolve) => {\n        startTransition(async () => {\n          if (!cartID) {\n            resolve()\n            return\n          }\n\n          const existingCart = await getCart(cartID, { secret: cartSecret })\n\n          if (!existingCart) {\n            // console.error(`Cart with ID \"${cartID}\" not found`)\n            setCartID(undefined)\n            setCart(undefined)\n            resolve()\n            return\n          }\n\n          // Check if the item already exists in the cart\n          const existingItemIndex =\n            existingCart.items?.findIndex((cartItem: CartItem) => cartItem.id === targetID) ?? -1\n\n          const updatedItems = existingCart.items ? [...existingCart.items] : []\n\n          if (existingItemIndex !== -1) {\n            // If the item exists, decrement its quantity\n            updatedItems[existingItemIndex].quantity = updatedItems[existingItemIndex].quantity - 1 // Decrement by 1\n\n            // If the quantity reaches 0, remove the item from the cart\n            if (updatedItems[existingItemIndex].quantity <= 0) {\n              updatedItems.splice(existingItemIndex, 1)\n            }\n\n            // Update the cart with the new items\n            await updateCart(cartID, {\n              items: updatedItems,\n            })\n          }\n          resolve()\n        })\n      })\n    },\n    [cartID, cartSecret, getCart, startTransition, updateCart],\n  )\n\n  const clearCart: EcommerceContextType['clearCart'] = useCallback(async () => {\n    return new Promise<void>((resolve) => {\n      startTransition(async () => {\n        if (cartID) {\n          await deleteCart(cartID)\n        }\n        resolve()\n      })\n    })\n  }, [cartID, deleteCart, startTransition])\n\n  const setCurrency: EcommerceContextType['setCurrency'] = useCallback(\n    (currency) => {\n      if (selectedCurrency.code === currency) {\n        return\n      }\n\n      const foundCurrency = currenciesConfig.supportedCurrencies.find((c) => c.code === currency)\n      if (!foundCurrency) {\n        throw new Error(`Currency with code \"${currency}\" not found in config`)\n      }\n\n      setSelectedCurrency(foundCurrency)\n    },\n    [currenciesConfig.supportedCurrencies, selectedCurrency.code],\n  )\n\n  const initiatePayment = useCallback<EcommerceContextType['initiatePayment']>(\n    async (paymentMethodID, options) => {\n      const paymentMethod = paymentMethods.find((method) => method.name === paymentMethodID)\n\n      if (!paymentMethod) {\n        throw new Error(`Payment method with ID \"${paymentMethodID}\" not found`)\n      }\n\n      if (!cartID) {\n        throw new Error(`No cart is provided.`)\n      }\n\n      setSelectedPaymentMethod(paymentMethodID)\n\n      if (paymentMethod.initiatePayment) {\n        const fetchURL = `${baseAPIURL}/payments/${paymentMethodID}/initiate`\n\n        const data = {\n          cartID,\n          currency: selectedCurrency.code,\n        }\n\n        try {\n          const response = await fetch(fetchURL, {\n            body: JSON.stringify({\n              ...data,\n              ...(options?.additionalData || {}),\n            }),\n            credentials: 'include',\n            headers: {\n              'Content-Type': 'application/json',\n            },\n            method: 'POST',\n          })\n\n          if (!response.ok) {\n            const responseError = await response.text()\n            throw new Error(responseError)\n          }\n\n          const responseData = await response.json()\n\n          if (responseData.error) {\n            throw new Error(responseData.error)\n          }\n\n          return responseData\n        } catch (error) {\n          if (debug) {\n            // eslint-disable-next-line no-console\n            console.error('Error initiating payment:', error)\n          }\n          throw new Error(error instanceof Error ? error.message : 'Failed to initiate payment')\n        }\n      } else {\n        throw new Error(`Payment method \"${paymentMethodID}\" does not support payment initiation`)\n      }\n    },\n    [baseAPIURL, cartID, debug, paymentMethods, selectedCurrency.code],\n  )\n\n  const confirmOrder = useCallback<EcommerceContextType['initiatePayment']>(\n    async (paymentMethodID, options) => {\n      if (!cartID) {\n        throw new Error(`Cart is empty.`)\n      }\n\n      const paymentMethod = paymentMethods.find((pm) => pm.name === paymentMethodID)\n\n      if (!paymentMethod) {\n        throw new Error(`Payment method with ID \"${paymentMethodID}\" not found`)\n      }\n\n      if (paymentMethod.confirmOrder) {\n        const fetchURL = `${baseAPIURL}/payments/${paymentMethodID}/confirm-order`\n\n        const data = {\n          cartID,\n          currency: selectedCurrency.code,\n        }\n\n        const response = await fetch(fetchURL, {\n          body: JSON.stringify({\n            ...data,\n            ...(options?.additionalData || {}),\n          }),\n          credentials: 'include',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          method: 'POST',\n        })\n\n        if (!response.ok) {\n          const responseError = await response.text()\n          throw new Error(responseError)\n        }\n\n        const responseData = await response.json()\n\n        if (responseData.error) {\n          throw new Error(responseData.error)\n        }\n\n        return responseData\n      } else {\n        throw new Error(`Payment method \"${paymentMethodID}\" does not support order confirmation`)\n      }\n    },\n    [baseAPIURL, cartID, paymentMethods, selectedCurrency.code],\n  )\n\n  const getUser = useCallback(async () => {\n    try {\n      const query = qs.stringify({\n        depth: 0,\n        select: {\n          id: true,\n          carts: true,\n        },\n      })\n\n      const response = await fetch(`${baseAPIURL}/${customersSlug}/me?${query}`, {\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        method: 'GET',\n      })\n\n      if (!response.ok) {\n        const errorText = await response.text()\n        throw new Error(`Failed to fetch user: ${errorText}`)\n      }\n\n      const userData = await response.json()\n\n      if (userData.error) {\n        throw new Error(`User fetch error: ${userData.error}`)\n      }\n\n      if (userData.user) {\n        setUser(userData.user as TypedUser)\n        return userData.user as TypedUser\n      }\n    } catch (error) {\n      if (debug) {\n        // eslint-disable-next-line no-console\n        console.error('Error fetching user:', error)\n      }\n      setUser(null)\n      throw new Error(\n        `Failed to fetch user: ${error instanceof Error ? error.message : 'Unknown error'}`,\n      )\n    }\n  }, [baseAPIURL, customersSlug, debug])\n\n  const refreshUser = useCallback<EcommerceContextType['refreshUser']>(async () => {\n    try {\n      const fetchedUser = await getUser()\n      if (fetchedUser && fetchedUser.cart?.docs && fetchedUser.cart.docs.length > 0) {\n        const userCartID =\n          typeof fetchedUser.cart.docs[0] === 'object'\n            ? fetchedUser.cart.docs[0].id\n            : fetchedUser.cart.docs[0]\n\n        if (userCartID) {\n          const fetchedCart = await getCart(userCartID)\n          setCart(fetchedCart)\n          setCartID(userCartID)\n        }\n      }\n    } catch (error) {\n      // User is not logged in, clear cart state for authenticated user\n      setUser(null)\n      // Don't clear cart - keep localStorage cart for guest\n    }\n  }, [getCart, getUser])\n\n  const getAddresses = useCallback(async () => {\n    if (!user) {\n      return\n    }\n\n    try {\n      const query = qs.stringify({\n        depth: 0,\n        limit: 0,\n        pagination: false,\n      })\n\n      const response = await fetch(`${baseAPIURL}/${addressesSlug}?${query}`, {\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        method: 'GET',\n      })\n\n      if (!response.ok) {\n        const errorText = await response.text()\n\n        throw new Error(errorText)\n      }\n\n      const data = await response.json()\n\n      if (data.error) {\n        throw new Error(`Address fetch error: ${data.error}`)\n      }\n\n      setAddresses(data.docs ?? [])\n    } catch (error) {\n      if (debug) {\n        // eslint-disable-next-line no-console\n        console.error('Error fetching addresses:', error)\n      }\n      setAddresses([])\n      // Don't rethrow - allow the operation to complete even if refresh fails\n    }\n  }, [user, baseAPIURL, addressesSlug, debug])\n\n  const updateAddress = useCallback<EcommerceContextType['updateAddress']>(\n    async (addressID, address) => {\n      if (!user) {\n        throw new Error('User must be logged in to update or create an address')\n      }\n\n      try {\n        const response = await fetch(`${baseAPIURL}/${addressesSlug}/${addressID}`, {\n          body: JSON.stringify(address),\n          credentials: 'include',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          method: 'PATCH',\n        })\n\n        if (!response.ok) {\n          const errorText = await response.text()\n          throw new Error(`Failed to update or create address: ${errorText}`)\n        }\n\n        const data = await response.json()\n\n        if (data.error) {\n          throw new Error(`Address update/create error: ${data.error}`)\n        }\n\n        // Refresh addresses after updating or creating\n        await getAddresses()\n      } catch (error) {\n        if (debug) {\n          // eslint-disable-next-line no-console\n          console.error('Error updating or creating address:', error)\n        }\n\n        throw new Error(\n          `Failed to update or create address: ${error instanceof Error ? error.message : 'Unknown error'}`,\n        )\n      }\n    },\n    [user, baseAPIURL, addressesSlug, getAddresses, debug],\n  )\n\n  const createAddress = useCallback<EcommerceContextType['createAddress']>(\n    async (address) => {\n      if (!user) {\n        throw new Error('User must be logged in to update or create an address')\n      }\n\n      try {\n        const response = await fetch(`${baseAPIURL}/${addressesSlug}`, {\n          body: JSON.stringify(address),\n          credentials: 'include',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          method: 'POST',\n        })\n\n        if (!response.ok) {\n          const errorText = await response.text()\n          throw new Error(`Failed to update or create address: ${errorText}`)\n        }\n\n        const data = await response.json()\n\n        if (data.error) {\n          throw new Error(`Address update/create error: ${data.error}`)\n        }\n\n        // Refresh addresses after updating or creating\n        await getAddresses()\n      } catch (error) {\n        if (debug) {\n          // eslint-disable-next-line no-console\n          console.error('Error updating or creating address:', error)\n        }\n\n        throw new Error(\n          `Failed to update or create address: ${error instanceof Error ? error.message : 'Unknown error'}`,\n        )\n      }\n    },\n    [user, baseAPIURL, addressesSlug, getAddresses, debug],\n  )\n\n  const deleteAddress = useCallback<EcommerceContextType['deleteAddress']>(\n    async (addressID) => {\n      if (!user) {\n        throw new Error('User must be logged in to delete an address')\n      }\n\n      try {\n        const response = await fetch(`${baseAPIURL}/${addressesSlug}/${addressID}`, {\n          credentials: 'include',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          method: 'DELETE',\n        })\n\n        if (!response.ok) {\n          const errorText = await response.text()\n          throw new Error(`Failed to delete address: ${errorText}`)\n        }\n\n        const data = await response.json()\n\n        if (data.error) {\n          throw new Error(`Address delete error: ${data.error}`)\n        }\n\n        // Refresh addresses after deleting\n        await getAddresses()\n      } catch (error) {\n        if (debug) {\n          // eslint-disable-next-line no-console\n          console.error('Error deleting address:', error)\n        }\n\n        throw new Error(\n          `Failed to delete address: ${error instanceof Error ? error.message : 'Unknown error'}`,\n        )\n      }\n    },\n    [user, baseAPIURL, addressesSlug, getAddresses, debug],\n  )\n\n  // If localStorage is enabled, restore cart from storage\n  useEffect(() => {\n    if (!hasRendered.current) {\n      if (syncLocalStorage) {\n        const storedCartID = localStorage.getItem(localStorageConfig.key)\n        const storedSecret = localStorage.getItem(`${localStorageConfig.key}_secret`)\n\n        if (storedCartID) {\n          getCart(storedCartID, { secret: storedSecret || undefined })\n            .then((fetchedCart) => {\n              setCart(fetchedCart)\n              setCartID(storedCartID as DefaultDocumentIDType)\n              if (storedSecret) {\n                setCartSecret(storedSecret)\n              }\n            })\n            .catch((_) => {\n              // console.error('Error fetching cart from localStorage:', error)\n              // If there's an error fetching the cart, clear it from localStorage\n              localStorage.removeItem(localStorageConfig.key)\n              localStorage.removeItem(`${localStorageConfig.key}_secret`)\n              setCartID(undefined)\n              setCart(undefined)\n              setCartSecret(undefined)\n            })\n        }\n      }\n\n      hasRendered.current = true\n\n      // Helper function to load user's cart\n      const loadUserCart = (userData: TypedUser) => {\n        if (userData.cart?.docs && userData.cart.docs.length > 0) {\n          const userCartID =\n            typeof userData.cart.docs[0] === 'object'\n              ? userData.cart.docs[0].id\n              : userData.cart.docs[0]\n\n          if (userCartID) {\n            getCart(userCartID)\n              .then((fetchedCart) => {\n                setCart(fetchedCart)\n                setCartID(userCartID)\n              })\n              .catch((error) => {\n                if (debug) {\n                  // eslint-disable-next-line no-console\n                  console.error('Error fetching user cart:', error)\n                }\n\n                setCart(undefined)\n                setCartID(undefined)\n\n                throw new Error(`Failed to fetch user cart: ${error.message}`)\n              })\n          }\n        }\n      }\n\n      // Fetch user from API\n      void getUser().then((fetchedUser) => {\n        if (fetchedUser) {\n          loadUserCart(fetchedUser)\n        }\n      })\n    }\n  }, [debug, getAddresses, getCart, getUser, localStorageConfig.key, syncLocalStorage])\n\n  useEffect(() => {\n    if (user) {\n      // If the user is logged in, fetch their addresses\n      void getAddresses()\n    } else {\n      // If no user is logged in, clear addresses\n      setAddresses(undefined)\n    }\n  }, [getAddresses, user])\n\n  return (\n    <EcommerceContext\n      value={{\n        addItem,\n        addresses,\n        cart,\n        clearCart,\n        confirmOrder,\n        createAddress,\n        deleteAddress,\n        currenciesConfig,\n        currency: selectedCurrency,\n        decrementItem,\n        incrementItem,\n        initiatePayment,\n        isLoading,\n        paymentMethods,\n        refreshUser,\n        removeItem,\n        selectedPaymentMethod,\n        setCurrency,\n        updateAddress,\n      }}\n    >\n      {children}\n    </EcommerceContext>\n  )\n}\n\nexport const useEcommerce = () => {\n  const context = use(EcommerceContext)\n\n  if (!context) {\n    throw new Error('useEcommerce must be used within an EcommerceProvider')\n  }\n\n  return context\n}\n\nexport const useCurrency = () => {\n  const { currenciesConfig, currency, setCurrency } = useEcommerce()\n\n  const formatCurrency = useCallback(\n    (value?: null | number, options?: { currency?: Currency }): string => {\n      if (value === undefined || value === null) {\n        return ''\n      }\n\n      const currencyToUse = options?.currency || currency\n\n      if (!currencyToUse) {\n        return value.toString()\n      }\n\n      if (value === 0) {\n        return `${currencyToUse.symbol}0.${'0'.repeat(currencyToUse.decimals)}`\n      }\n\n      // Convert from base value (e.g., cents) to decimal value (e.g., dollars)\n      const decimalValue = value / Math.pow(10, currencyToUse.decimals)\n\n      // Format with the correct number of decimal places\n      return `${currencyToUse.symbol}${decimalValue.toFixed(currencyToUse.decimals)}`\n    },\n    [currency],\n  )\n\n  if (!currency) {\n    throw new Error('useCurrency must be used within an EcommerceProvider')\n  }\n\n  return {\n    currency,\n    formatCurrency,\n    setCurrency,\n    supportedCurrencies: currenciesConfig.supportedCurrencies,\n  }\n}\n\nexport function useCart<T extends CartsCollection>() {\n  const { addItem, cart, clearCart, decrementItem, incrementItem, isLoading, removeItem } =\n    useEcommerce()\n\n  if (!addItem) {\n    throw new Error('useCart must be used within an EcommerceProvider')\n  }\n\n  return {\n    addItem,\n    cart: cart as T,\n    clearCart,\n    decrementItem,\n    incrementItem,\n    isLoading,\n    removeItem,\n  }\n}\n\nexport const usePayments = () => {\n  const { confirmOrder, initiatePayment, isLoading, paymentMethods, selectedPaymentMethod } =\n    useEcommerce()\n\n  if (!initiatePayment) {\n    throw new Error('usePayments must be used within an EcommerceProvider')\n  }\n\n  return { confirmOrder, initiatePayment, isLoading, paymentMethods, selectedPaymentMethod }\n}\n\nexport function useAddresses<T extends AddressesCollection>() {\n  const { addresses, createAddress, deleteAddress, isLoading, updateAddress } = useEcommerce()\n\n  if (!createAddress) {\n    throw new Error('useAddresses must be used within an EcommerceProvider')\n  }\n\n  return { addresses: addresses as T[], createAddress, deleteAddress, isLoading, updateAddress }\n}\n"],"names":["deepMergeSimple","formatAdminURL","qs","React","createContext","use","useCallback","useEffect","useMemo","useRef","useState","useTransition","defaultContext","addItem","clearCart","confirmOrder","createAddress","deleteAddress","currenciesConfig","defaultCurrency","supportedCurrencies","code","decimals","label","symbol","currency","decrementItem","incrementItem","initiatePayment","isLoading","paymentMethods","refreshUser","removeItem","setCurrency","updateAddress","EcommerceContext","defaultLocalStorage","key","EcommerceProvider","addressesSlug","api","cartsSlug","children","customersSlug","debug","syncLocalStorage","localStorageConfig","apiRoute","cartsFetchQuery","baseAPIURL","path","startTransition","user","setUser","addresses","setAddresses","hasRendered","cartID","setCartID","cartSecret","setCartSecret","undefined","cart","setCart","selectedCurrency","setSelectedCurrency","find","c","selectedPaymentMethod","setSelectedPaymentMethod","cartQuery","priceField","baseQuery","depth","populate","products","variants","options","select","items","subtotal","createCart","initialData","query","stringify","response","fetch","body","JSON","customer","id","credentials","headers","method","ok","errorText","text","Error","data","json","error","doc","secret","getCart","queryParams","updateCart","updatedCart","deleteCart","url","current","localStorage","setItem","item","quantity","Promise","resolve","existingCart","existingItemIndex","findIndex","cartItem","productID","product","variantID","variant","updatedItems","newCart","targetID","splice","foundCurrency","paymentMethodID","paymentMethod","name","fetchURL","additionalData","responseError","responseData","console","message","pm","getUser","carts","userData","fetchedUser","docs","length","userCartID","fetchedCart","getAddresses","limit","pagination","addressID","address","storedCartID","getItem","storedSecret","then","catch","_","loadUserCart","value","useEcommerce","context","useCurrency","formatCurrency","currencyToUse","toString","repeat","decimalValue","Math","pow","toFixed","useCart","usePayments","useAddresses"],"mappings":"AAAA;;AAGA,SAASA,eAAe,EAAEC,cAAc,QAAQ,iBAAgB;AAChE,YAAYC,QAAQ,SAAQ;AAC5B,OAAOC,SACLC,aAAa,EACbC,GAAG,EACHC,WAAW,EACXC,SAAS,EACTC,OAAO,EACPC,MAAM,EACNC,QAAQ,EACRC,aAAa,QACR,QAAO;AAWd,MAAMC,iBAAuC;IAC3CC,SAAS,WAAa;IACtBC,WAAW,WAAa;IACxBC,cAAc,WAAa;IAC3BC,eAAe,WAAa;IAC5BC,eAAe,WAAa;IAC5BC,kBAAkB;QAChBC,iBAAiB;QACjBC,qBAAqB;YACnB;gBACEC,MAAM;gBACNC,UAAU;gBACVC,OAAO;gBACPC,QAAQ;YACV;SACD;IACH;IACAC,UAAU;QACRJ,MAAM;QACNC,UAAU;QACVC,OAAO;QACPC,QAAQ;IACV;IACAE,eAAe,WAAa;IAC5BC,eAAe,WAAa;IAC5BC,iBAAiB,WAAa;IAC9BC,WAAW;IACXC,gBAAgB,EAAE;IAClBC,aAAa,WAAa;IAC1BC,YAAY,WAAa;IACzBC,aAAa,KAAO;IACpBC,eAAe,WAAa;AAC9B;AAEA,MAAMC,iCAAmB/B,cAAoCQ;AAE7D,MAAMwB,sBAAsB;IAC1BC,KAAK;AACP;AAEA,OAAO,MAAMC,oBAA4C,CAAC,EACxDC,gBAAgB,WAAW,EAC3BC,GAAG,EACHC,YAAY,OAAO,EACnBC,QAAQ,EACRxB,mBAAmB;IACjBC,iBAAiB;IACjBC,qBAAqB;QACnB;YACEC,MAAM;YACNC,UAAU;YACVC,OAAO;YACPC,QAAQ;QACV;KACD;AACH,CAAC,EACDmB,gBAAgB,OAAO,EACvBC,QAAQ,KAAK,EACbd,iBAAiB,EAAE,EACnBe,mBAAmB,IAAI,EACxB;IACC,MAAMC,qBACJD,oBAAoB,OAAOA,qBAAqB,WAC5C;QACE,GAAGT,mBAAmB;QACtB,GAAGS,gBAAgB;IACrB,IACAT;IAEN,MAAM,EAAEW,WAAW,MAAM,EAAEC,kBAAkB,CAAC,CAAC,EAAE,GAAGR,OAAO,CAAC;IAC5D,MAAMS,aAAahD,eAAe;QAChC8C;QACAG,MAAM;IACR;IAEA,MAAM,CAACrB,WAAWsB,gBAAgB,GAAGxC;IAErC,MAAM,CAACyC,MAAMC,QAAQ,GAAG3C,SAA2B;IAEnD,MAAM,CAAC4C,WAAWC,aAAa,GAAG7C;IAElC,MAAM8C,cAAc/C,OAAO;IAE3B;;;;GAIC,GACD,MAAM,CAACgD,QAAQC,UAAU,GAAGhD;IAC5B;;;GAGC,GACD,MAAM,CAACiD,YAAYC,cAAc,GAAGlD,SAA6BmD;IACjE,MAAM,CAACC,MAAMC,QAAQ,GAAGrD;IAExB,MAAM,CAACsD,kBAAkBC,oBAAoB,GAAGvD,SAC9C,IACEQ,iBAAiBE,mBAAmB,CAAC8C,IAAI,CACvC,CAACC,IAAMA,EAAE9C,IAAI,KAAKH,iBAAiBC,eAAe;IAIxD,MAAM,CAACiD,uBAAuBC,yBAAyB,GAAG3D,SAAwB;IAElF,MAAM4D,YAAY9D,QAAQ;QACxB,MAAM+D,aAAa,CAAC,OAAO,EAAEP,iBAAiB3C,IAAI,EAAE;QAEpD,MAAMmD,YAAY;YAChBC,OAAO;YACPC,UAAU;gBACRC,UAAU;oBACR,CAACJ,WAAW,EAAE;gBAChB;gBACAK,UAAU;oBACRC,SAAS;oBACT,CAACN,WAAW,EAAE;gBAChB;YACF;YACAO,QAAQ;gBACNC,OAAO;gBACPC,UAAU;YACZ;QACF;QAEA,OAAOhF,gBAAgBwE,WAAWxB;IACpC,GAAG;QAACgB,iBAAiB3C,IAAI;QAAE2B;KAAgB;IAE3C,MAAMiC,aAAa3E,YACjB,OAAO4E;QACL,MAAMC,QAAQjF,GAAGkF,SAAS,CAACd;QAE3B,MAAMe,WAAW,MAAMC,MAAM,GAAGrC,WAAW,CAAC,EAAER,UAAU,CAAC,EAAE0C,OAAO,EAAE;YAClEI,MAAMC,KAAKJ,SAAS,CAAC;gBACnB,GAAGF,WAAW;gBACdzD,UAAUuC,iBAAiB3C,IAAI;gBAC/BoE,UAAUrC,MAAMsC;YAClB;YACAC,aAAa;YACbC,SAAS;gBACP,gBAAgB;YAClB;YACAC,QAAQ;QACV;QAEA,IAAI,CAACR,SAASS,EAAE,EAAE;YAChB,MAAMC,YAAY,MAAMV,SAASW,IAAI;YACrC,MAAM,IAAIC,MAAM,CAAC,uBAAuB,EAAEF,WAAW;QACvD;QAEA,MAAMG,OAAO,MAAMb,SAASc,IAAI;QAEhC,IAAID,KAAKE,KAAK,EAAE;YACd,MAAM,IAAIH,MAAM,CAAC,qBAAqB,EAAEC,KAAKE,KAAK,EAAE;QACtD;QAEA,yCAAyC;QACzC,IAAI,CAAChD,QAAQ8C,KAAKG,GAAG,EAAEC,QAAQ;YAC7B1C,cAAcsC,KAAKG,GAAG,CAACC,MAAM;QAC/B;QAEA,OAAOJ,KAAKG,GAAG;IACjB,GACA;QAACpD;QAAYqB;QAAW7B;QAAWuB,iBAAiB3C,IAAI;QAAE+B;KAAK;IAGjE,MAAMmD,UAAUjG,YACd,OAAOmD,QAA+BoB;QACpC,MAAMyB,SAASzB,SAASyB;QAExB,6CAA6C;QAC7C,MAAME,cAAc;YAClB,GAAGlC,SAAS;YACZ,GAAIgC,SAAS;gBAAEA;YAAO,IAAI,CAAC,CAAC;QAC9B;QACA,MAAMnB,QAAQjF,GAAGkF,SAAS,CAACoB;QAE3B,MAAMnB,WAAW,MAAMC,MAAM,GAAGrC,WAAW,CAAC,EAAER,UAAU,CAAC,EAAEgB,OAAO,CAAC,EAAE0B,OAAO,EAAE;YAC5EQ,aAAa;YACbC,SAAS;gBACP,gBAAgB;YAClB;YACAC,QAAQ;QACV;QAEA,IAAI,CAACR,SAASS,EAAE,EAAE;YAChB,MAAMC,YAAY,MAAMV,SAASW,IAAI;YACrC,MAAM,IAAIC,MAAM,CAAC,sBAAsB,EAAEF,WAAW;QACtD;QAEA,MAAMG,OAAO,MAAMb,SAASc,IAAI;QAEhC,IAAID,KAAKE,KAAK,EAAE;YACd,MAAM,IAAIH,MAAM,CAAC,kBAAkB,EAAEC,KAAKE,KAAK,EAAE;QACnD;QAEA,OAAOF;IACT,GACA;QAACjD;QAAYqB;QAAW7B;KAAU;IAGpC,MAAMgE,aAAanG,YACjB,OAAOmD,QAA+ByC;QACpC,6CAA6C;QAC7C,MAAMM,cAAc;YAClB,GAAGlC,SAAS;YACZ,GAAIX,aAAa;gBAAE2C,QAAQ3C;YAAW,IAAI,CAAC,CAAC;QAC9C;QACA,MAAMwB,QAAQjF,GAAGkF,SAAS,CAACoB;QAE3B,MAAMnB,WAAW,MAAMC,MAAM,GAAGrC,WAAW,CAAC,EAAER,UAAU,CAAC,EAAEgB,OAAO,CAAC,EAAE0B,OAAO,EAAE;YAC5EI,MAAMC,KAAKJ,SAAS,CAACc;YACrBP,aAAa;YACbC,SAAS;gBACP,gBAAgB;YAClB;YACAC,QAAQ;QACV;QAEA,IAAI,CAACR,SAASS,EAAE,EAAE;YAChB,MAAMC,YAAY,MAAMV,SAASW,IAAI;YACrC,MAAM,IAAIC,MAAM,CAAC,uBAAuB,EAAEF,WAAW;QACvD;QAEA,MAAMW,cAAc,MAAMrB,SAASc,IAAI;QAEvCpC,QAAQ2C,YAAYL,GAAG;IACzB,GACA;QAACpD;QAAYqB;QAAW7B;QAAWkB;KAAW;IAGhD,MAAMgD,aAAarG,YACjB,OAAOmD;QACL,6CAA6C;QAC7C,MAAM+C,cAAc7C,aAAa;YAAE2C,QAAQ3C;QAAW,IAAI,CAAC;QAC3D,MAAMwB,QAAQjF,GAAGkF,SAAS,CAACoB;QAC3B,MAAMI,MAAM,GAAG3D,WAAW,CAAC,EAAER,UAAU,CAAC,EAAEgB,SAAS0B,QAAQ,CAAC,CAAC,EAAEA,OAAO,GAAG,IAAI;QAE7E,MAAME,WAAW,MAAMC,MAAMsB,KAAK;YAChCjB,aAAa;YACbC,SAAS;gBACP,gBAAgB;YAClB;YACAC,QAAQ;QACV;QAEA,IAAI,CAACR,SAASS,EAAE,EAAE;YAChB,MAAMC,YAAY,MAAMV,SAASW,IAAI;YACrC,MAAM,IAAIC,MAAM,CAAC,uBAAuB,EAAEF,WAAW;QACvD;QAEAhC,QAAQF;QACRH,UAAUG;QACVD,cAAcC;IAChB,GACA;QAACZ;QAAYR;QAAWkB;KAAW;IAGrC,6CAA6C;IAC7CpD,UAAU;QACR,IAAIiD,YAAYqD,OAAO,EAAE;YACvB,IAAIhE,kBAAkB;gBACpB,IAAIY,QAAQ;oBACVqD,aAAaC,OAAO,CAACjE,mBAAmBT,GAAG,EAAEoB;gBAC/C,OAAO;oBACLqD,aAAa9E,UAAU,CAACc,mBAAmBT,GAAG;gBAChD;gBAEA,IAAIsB,YAAY;oBACdmD,aAAaC,OAAO,CAAC,GAAGjE,mBAAmBT,GAAG,CAAC,OAAO,CAAC,EAAEsB;gBAC3D,OAAO;oBACLmD,aAAa9E,UAAU,CAAC,GAAGc,mBAAmBT,GAAG,CAAC,OAAO,CAAC;gBAC5D;YACF;QACF;IACF,GAAG;QAACoB;QAAQE;QAAYb,mBAAmBT,GAAG;QAAEQ;KAAiB;IAEjE,MAAMhC,UAA2CP,YAC/C,OAAO0G,MAAMC,WAAW,CAAC;QACvB,OAAO,IAAIC,QAAc,CAACC;YACxBhE,gBAAgB;gBACd,IAAIM,QAAQ;oBACV,MAAM2D,eAAe,MAAMb,QAAQ9C,QAAQ;wBAAE6C,QAAQ3C;oBAAW;oBAEhE,IAAI,CAACyD,cAAc;wBACjB,sDAAsD;wBAEtD1D,UAAUG;wBACVE,QAAQF;wBACR;oBACF;oBAEA,+CAA+C;oBAC/C,MAAMwD,oBACJD,aAAarC,KAAK,EAAEuC,UAAU,CAACC;wBAC7B,MAAMC,YACJ,OAAOD,SAASE,OAAO,KAAK,WAAWF,SAASE,OAAO,CAAC/B,EAAE,GAAGsB,KAAKS,OAAO;wBAC3E,MAAMC,YACJH,SAASI,OAAO,IAAI,OAAOJ,SAASI,OAAO,KAAK,WAC5CJ,SAASI,OAAO,CAACjC,EAAE,GACnBsB,KAAKW,OAAO;wBAElB,OACEH,cAAcR,KAAKS,OAAO,IACzBT,CAAAA,KAAKW,OAAO,IAAID,YAAYA,cAAcV,KAAKW,OAAO,GAAG,IAAG;oBAEjE,MAAM,CAAC;oBAET,IAAIC,eAAeR,aAAarC,KAAK,GAAG;2BAAIqC,aAAarC,KAAK;qBAAC,GAAG,EAAE;oBAEpE,IAAIsC,sBAAsB,CAAC,GAAG;wBAC5B,0CAA0C;wBAC1CO,YAAY,CAACP,kBAAkB,CAACJ,QAAQ,GACtCW,YAAY,CAACP,kBAAkB,CAACJ,QAAQ,GAAGA;wBAE7C,qCAAqC;wBACrC,MAAMR,WAAWhD,QAAQ;4BACvBsB,OAAO6C;wBACT;oBACF,OAAO;wBACL,iDAAiD;wBACjDA,eAAe;+BAAKR,aAAarC,KAAK,IAAI,EAAE;4BAAG;gCAAE,GAAGiC,IAAI;gCAAEC;4BAAS;yBAAE;oBACvE;oBAEA,qCAAqC;oBACrC,MAAMR,WAAWhD,QAAQ;wBACvBsB,OAAO6C;oBACT;gBACF,OAAO;oBACL,yCAAyC;oBACzC,MAAMC,UAAU,MAAM5C,WAAW;wBAAEF,OAAO;4BAAC;gCAAE,GAAGiC,IAAI;gCAAEC;4BAAS;yBAAE;oBAAC;oBAElEvD,UAAUmE,QAAQnC,EAAE;oBACpB3B,QAAQ8D;gBACV;gBACAV;YACF;QACF;IACF,GACA;QAAC1D;QAAQE;QAAYsB;QAAYsB;QAASpD;QAAiBsD;KAAW;IAGxE,MAAMzE,aAAiD1B,YACrD,OAAOwH;QACL,OAAO,IAAIZ,QAAc,CAACC;YACxBhE,gBAAgB;gBACd,IAAI,CAACM,QAAQ;oBACX0D;oBACA;gBACF;gBAEA,MAAMC,eAAe,MAAMb,QAAQ9C,QAAQ;oBAAE6C,QAAQ3C;gBAAW;gBAEhE,IAAI,CAACyD,cAAc;oBACjB,sDAAsD;oBACtD1D,UAAUG;oBACVE,QAAQF;oBACRsD;oBACA;gBACF;gBAEA,+CAA+C;gBAC/C,MAAME,oBACJD,aAAarC,KAAK,EAAEuC,UAAU,CAACC,WAAuBA,SAAS7B,EAAE,KAAKoC,aAAa,CAAC;gBAEtF,IAAIT,sBAAsB,CAAC,GAAG;oBAC5B,8CAA8C;oBAC9C,MAAMO,eAAeR,aAAarC,KAAK,GAAG;2BAAIqC,aAAarC,KAAK;qBAAC,GAAG,EAAE;oBACtE6C,aAAaG,MAAM,CAACV,mBAAmB;oBAEvC,qCAAqC;oBACrC,MAAMZ,WAAWhD,QAAQ;wBACvBsB,OAAO6C;oBACT;gBACF;gBACAT;YACF;QACF;IACF,GACA;QAAC1D;QAAQE;QAAY4C;QAASpD;QAAiBsD;KAAW;IAG5D,MAAM9E,gBAAuDrB,YAC3D,OAAOwH;QACL,OAAO,IAAIZ,QAAc,CAACC;YACxBhE,gBAAgB;gBACd,IAAI,CAACM,QAAQ;oBACX0D;oBACA;gBACF;gBAEA,MAAMC,eAAe,MAAMb,QAAQ9C,QAAQ;oBAAE6C,QAAQ3C;gBAAW;gBAEhE,IAAI,CAACyD,cAAc;oBACjB,sDAAsD;oBACtD1D,UAAUG;oBACVE,QAAQF;oBACRsD;oBACA;gBACF;gBAEA,+CAA+C;gBAC/C,MAAME,oBACJD,aAAarC,KAAK,EAAEuC,UAAU,CAACC,WAAuBA,SAAS7B,EAAE,KAAKoC,aAAa,CAAC;gBAEtF,IAAIF,eAAeR,aAAarC,KAAK,GAAG;uBAAIqC,aAAarC,KAAK;iBAAC,GAAG,EAAE;gBAEpE,IAAIsC,sBAAsB,CAAC,GAAG;oBAC5B,6CAA6C;oBAC7CO,YAAY,CAACP,kBAAkB,CAACJ,QAAQ,GAAGW,YAAY,CAACP,kBAAkB,CAACJ,QAAQ,GAAG,GAAE,iBAAiB;oBACzG,qCAAqC;oBACrC,MAAMR,WAAWhD,QAAQ;wBACvBsB,OAAO6C;oBACT;gBACF,OAAO;oBACL,iEAAiE;oBACjEA,eAAe;2BAAKR,aAAarC,KAAK,IAAI,EAAE;wBAAG;4BAAE0C,SAASK;4BAAUb,UAAU;wBAAE;qBAAE;oBAClF,qCAAqC;oBACrC,MAAMR,WAAWhD,QAAQ;wBACvBsB,OAAO6C;oBACT;gBACF;gBACAT;YACF;QACF;IACF,GACA;QAAC1D;QAAQE;QAAY4C;QAASpD;QAAiBsD;KAAW;IAG5D,MAAM/E,gBAAuDpB,YAC3D,OAAOwH;QACL,OAAO,IAAIZ,QAAc,CAACC;YACxBhE,gBAAgB;gBACd,IAAI,CAACM,QAAQ;oBACX0D;oBACA;gBACF;gBAEA,MAAMC,eAAe,MAAMb,QAAQ9C,QAAQ;oBAAE6C,QAAQ3C;gBAAW;gBAEhE,IAAI,CAACyD,cAAc;oBACjB,sDAAsD;oBACtD1D,UAAUG;oBACVE,QAAQF;oBACRsD;oBACA;gBACF;gBAEA,+CAA+C;gBAC/C,MAAME,oBACJD,aAAarC,KAAK,EAAEuC,UAAU,CAACC,WAAuBA,SAAS7B,EAAE,KAAKoC,aAAa,CAAC;gBAEtF,MAAMF,eAAeR,aAAarC,KAAK,GAAG;uBAAIqC,aAAarC,KAAK;iBAAC,GAAG,EAAE;gBAEtE,IAAIsC,sBAAsB,CAAC,GAAG;oBAC5B,6CAA6C;oBAC7CO,YAAY,CAACP,kBAAkB,CAACJ,QAAQ,GAAGW,YAAY,CAACP,kBAAkB,CAACJ,QAAQ,GAAG,GAAE,iBAAiB;oBAEzG,2DAA2D;oBAC3D,IAAIW,YAAY,CAACP,kBAAkB,CAACJ,QAAQ,IAAI,GAAG;wBACjDW,aAAaG,MAAM,CAACV,mBAAmB;oBACzC;oBAEA,qCAAqC;oBACrC,MAAMZ,WAAWhD,QAAQ;wBACvBsB,OAAO6C;oBACT;gBACF;gBACAT;YACF;QACF;IACF,GACA;QAAC1D;QAAQE;QAAY4C;QAASpD;QAAiBsD;KAAW;IAG5D,MAAM3F,YAA+CR,YAAY;QAC/D,OAAO,IAAI4G,QAAc,CAACC;YACxBhE,gBAAgB;gBACd,IAAIM,QAAQ;oBACV,MAAMkD,WAAWlD;gBACnB;gBACA0D;YACF;QACF;IACF,GAAG;QAAC1D;QAAQkD;QAAYxD;KAAgB;IAExC,MAAMlB,cAAmD3B,YACvD,CAACmB;QACC,IAAIuC,iBAAiB3C,IAAI,KAAKI,UAAU;YACtC;QACF;QAEA,MAAMuG,gBAAgB9G,iBAAiBE,mBAAmB,CAAC8C,IAAI,CAAC,CAACC,IAAMA,EAAE9C,IAAI,KAAKI;QAClF,IAAI,CAACuG,eAAe;YAClB,MAAM,IAAI/B,MAAM,CAAC,oBAAoB,EAAExE,SAAS,qBAAqB,CAAC;QACxE;QAEAwC,oBAAoB+D;IACtB,GACA;QAAC9G,iBAAiBE,mBAAmB;QAAE4C,iBAAiB3C,IAAI;KAAC;IAG/D,MAAMO,kBAAkBtB,YACtB,OAAO2H,iBAAiBpD;QACtB,MAAMqD,gBAAgBpG,eAAeoC,IAAI,CAAC,CAAC2B,SAAWA,OAAOsC,IAAI,KAAKF;QAEtE,IAAI,CAACC,eAAe;YAClB,MAAM,IAAIjC,MAAM,CAAC,wBAAwB,EAAEgC,gBAAgB,WAAW,CAAC;QACzE;QAEA,IAAI,CAACxE,QAAQ;YACX,MAAM,IAAIwC,MAAM,CAAC,oBAAoB,CAAC;QACxC;QAEA5B,yBAAyB4D;QAEzB,IAAIC,cAActG,eAAe,EAAE;YACjC,MAAMwG,WAAW,GAAGnF,WAAW,UAAU,EAAEgF,gBAAgB,SAAS,CAAC;YAErE,MAAM/B,OAAO;gBACXzC;gBACAhC,UAAUuC,iBAAiB3C,IAAI;YACjC;YAEA,IAAI;gBACF,MAAMgE,WAAW,MAAMC,MAAM8C,UAAU;oBACrC7C,MAAMC,KAAKJ,SAAS,CAAC;wBACnB,GAAGc,IAAI;wBACP,GAAIrB,SAASwD,kBAAkB,CAAC,CAAC;oBACnC;oBACA1C,aAAa;oBACbC,SAAS;wBACP,gBAAgB;oBAClB;oBACAC,QAAQ;gBACV;gBAEA,IAAI,CAACR,SAASS,EAAE,EAAE;oBAChB,MAAMwC,gBAAgB,MAAMjD,SAASW,IAAI;oBACzC,MAAM,IAAIC,MAAMqC;gBAClB;gBAEA,MAAMC,eAAe,MAAMlD,SAASc,IAAI;gBAExC,IAAIoC,aAAanC,KAAK,EAAE;oBACtB,MAAM,IAAIH,MAAMsC,aAAanC,KAAK;gBACpC;gBAEA,OAAOmC;YACT,EAAE,OAAOnC,OAAO;gBACd,IAAIxD,OAAO;oBACT,sCAAsC;oBACtC4F,QAAQpC,KAAK,CAAC,6BAA6BA;gBAC7C;gBACA,MAAM,IAAIH,MAAMG,iBAAiBH,QAAQG,MAAMqC,OAAO,GAAG;YAC3D;QACF,OAAO;YACL,MAAM,IAAIxC,MAAM,CAAC,gBAAgB,EAAEgC,gBAAgB,qCAAqC,CAAC;QAC3F;IACF,GACA;QAAChF;QAAYQ;QAAQb;QAAOd;QAAgBkC,iBAAiB3C,IAAI;KAAC;IAGpE,MAAMN,eAAeT,YACnB,OAAO2H,iBAAiBpD;QACtB,IAAI,CAACpB,QAAQ;YACX,MAAM,IAAIwC,MAAM,CAAC,cAAc,CAAC;QAClC;QAEA,MAAMiC,gBAAgBpG,eAAeoC,IAAI,CAAC,CAACwE,KAAOA,GAAGP,IAAI,KAAKF;QAE9D,IAAI,CAACC,eAAe;YAClB,MAAM,IAAIjC,MAAM,CAAC,wBAAwB,EAAEgC,gBAAgB,WAAW,CAAC;QACzE;QAEA,IAAIC,cAAcnH,YAAY,EAAE;YAC9B,MAAMqH,WAAW,GAAGnF,WAAW,UAAU,EAAEgF,gBAAgB,cAAc,CAAC;YAE1E,MAAM/B,OAAO;gBACXzC;gBACAhC,UAAUuC,iBAAiB3C,IAAI;YACjC;YAEA,MAAMgE,WAAW,MAAMC,MAAM8C,UAAU;gBACrC7C,MAAMC,KAAKJ,SAAS,CAAC;oBACnB,GAAGc,IAAI;oBACP,GAAIrB,SAASwD,kBAAkB,CAAC,CAAC;gBACnC;gBACA1C,aAAa;gBACbC,SAAS;oBACP,gBAAgB;gBAClB;gBACAC,QAAQ;YACV;YAEA,IAAI,CAACR,SAASS,EAAE,EAAE;gBAChB,MAAMwC,gBAAgB,MAAMjD,SAASW,IAAI;gBACzC,MAAM,IAAIC,MAAMqC;YAClB;YAEA,MAAMC,eAAe,MAAMlD,SAASc,IAAI;YAExC,IAAIoC,aAAanC,KAAK,EAAE;gBACtB,MAAM,IAAIH,MAAMsC,aAAanC,KAAK;YACpC;YAEA,OAAOmC;QACT,OAAO;YACL,MAAM,IAAItC,MAAM,CAAC,gBAAgB,EAAEgC,gBAAgB,qCAAqC,CAAC;QAC3F;IACF,GACA;QAAChF;QAAYQ;QAAQ3B;QAAgBkC,iBAAiB3C,IAAI;KAAC;IAG7D,MAAMsH,UAAUrI,YAAY;QAC1B,IAAI;YACF,MAAM6E,QAAQjF,GAAGkF,SAAS,CAAC;gBACzBX,OAAO;gBACPK,QAAQ;oBACNY,IAAI;oBACJkD,OAAO;gBACT;YACF;YAEA,MAAMvD,WAAW,MAAMC,MAAM,GAAGrC,WAAW,CAAC,EAAEN,cAAc,IAAI,EAAEwC,OAAO,EAAE;gBACzEQ,aAAa;gBACbC,SAAS;oBACP,gBAAgB;gBAClB;gBACAC,QAAQ;YACV;YAEA,IAAI,CAACR,SAASS,EAAE,EAAE;gBAChB,MAAMC,YAAY,MAAMV,SAASW,IAAI;gBACrC,MAAM,IAAIC,MAAM,CAAC,sBAAsB,EAAEF,WAAW;YACtD;YAEA,MAAM8C,WAAW,MAAMxD,SAASc,IAAI;YAEpC,IAAI0C,SAASzC,KAAK,EAAE;gBAClB,MAAM,IAAIH,MAAM,CAAC,kBAAkB,EAAE4C,SAASzC,KAAK,EAAE;YACvD;YAEA,IAAIyC,SAASzF,IAAI,EAAE;gBACjBC,QAAQwF,SAASzF,IAAI;gBACrB,OAAOyF,SAASzF,IAAI;YACtB;QACF,EAAE,OAAOgD,OAAO;YACd,IAAIxD,OAAO;gBACT,sCAAsC;gBACtC4F,QAAQpC,KAAK,CAAC,wBAAwBA;YACxC;YACA/C,QAAQ;YACR,MAAM,IAAI4C,MACR,CAAC,sBAAsB,EAAEG,iBAAiBH,QAAQG,MAAMqC,OAAO,GAAG,iBAAiB;QAEvF;IACF,GAAG;QAACxF;QAAYN;QAAeC;KAAM;IAErC,MAAMb,cAAczB,YAAiD;QACnE,IAAI;YACF,MAAMwI,cAAc,MAAMH;YAC1B,IAAIG,eAAeA,YAAYhF,IAAI,EAAEiF,QAAQD,YAAYhF,IAAI,CAACiF,IAAI,CAACC,MAAM,GAAG,GAAG;gBAC7E,MAAMC,aACJ,OAAOH,YAAYhF,IAAI,CAACiF,IAAI,CAAC,EAAE,KAAK,WAChCD,YAAYhF,IAAI,CAACiF,IAAI,CAAC,EAAE,CAACrD,EAAE,GAC3BoD,YAAYhF,IAAI,CAACiF,IAAI,CAAC,EAAE;gBAE9B,IAAIE,YAAY;oBACd,MAAMC,cAAc,MAAM3C,QAAQ0C;oBAClClF,QAAQmF;oBACRxF,UAAUuF;gBACZ;YACF;QACF,EAAE,OAAO7C,OAAO;YACd,iEAAiE;YACjE/C,QAAQ;QACR,sDAAsD;QACxD;IACF,GAAG;QAACkD;QAASoC;KAAQ;IAErB,MAAMQ,eAAe7I,YAAY;QAC/B,IAAI,CAAC8C,MAAM;YACT;QACF;QAEA,IAAI;YACF,MAAM+B,QAAQjF,GAAGkF,SAAS,CAAC;gBACzBX,OAAO;gBACP2E,OAAO;gBACPC,YAAY;YACd;YAEA,MAAMhE,WAAW,MAAMC,MAAM,GAAGrC,WAAW,CAAC,EAAEV,cAAc,CAAC,EAAE4C,OAAO,EAAE;gBACtEQ,aAAa;gBACbC,SAAS;oBACP,gBAAgB;gBAClB;gBACAC,QAAQ;YACV;YAEA,IAAI,CAACR,SAASS,EAAE,EAAE;gBAChB,MAAMC,YAAY,MAAMV,SAASW,IAAI;gBAErC,MAAM,IAAIC,MAAMF;YAClB;YAEA,MAAMG,OAAO,MAAMb,SAASc,IAAI;YAEhC,IAAID,KAAKE,KAAK,EAAE;gBACd,MAAM,IAAIH,MAAM,CAAC,qBAAqB,EAAEC,KAAKE,KAAK,EAAE;YACtD;YAEA7C,aAAa2C,KAAK6C,IAAI,IAAI,EAAE;QAC9B,EAAE,OAAO3C,OAAO;YACd,IAAIxD,OAAO;gBACT,sCAAsC;gBACtC4F,QAAQpC,KAAK,CAAC,6BAA6BA;YAC7C;YACA7C,aAAa,EAAE;QACf,wEAAwE;QAC1E;IACF,GAAG;QAACH;QAAMH;QAAYV;QAAeK;KAAM;IAE3C,MAAMV,gBAAgB5B,YACpB,OAAOgJ,WAAWC;QAChB,IAAI,CAACnG,MAAM;YACT,MAAM,IAAI6C,MAAM;QAClB;QAEA,IAAI;YACF,MAAMZ,WAAW,MAAMC,MAAM,GAAGrC,WAAW,CAAC,EAAEV,cAAc,CAAC,EAAE+G,WAAW,EAAE;gBAC1E/D,MAAMC,KAAKJ,SAAS,CAACmE;gBACrB5D,aAAa;gBACbC,SAAS;oBACP,gBAAgB;gBAClB;gBACAC,QAAQ;YACV;YAEA,IAAI,CAACR,SAASS,EAAE,EAAE;gBAChB,MAAMC,YAAY,MAAMV,SAASW,IAAI;gBACrC,MAAM,IAAIC,MAAM,CAAC,oCAAoC,EAAEF,WAAW;YACpE;YAEA,MAAMG,OAAO,MAAMb,SAASc,IAAI;YAEhC,IAAID,KAAKE,KAAK,EAAE;gBACd,MAAM,IAAIH,MAAM,CAAC,6BAA6B,EAAEC,KAAKE,KAAK,EAAE;YAC9D;YAEA,+CAA+C;YAC/C,MAAM+C;QACR,EAAE,OAAO/C,OAAO;YACd,IAAIxD,OAAO;gBACT,sCAAsC;gBACtC4F,QAAQpC,KAAK,CAAC,uCAAuCA;YACvD;YAEA,MAAM,IAAIH,MACR,CAAC,oCAAoC,EAAEG,iBAAiBH,QAAQG,MAAMqC,OAAO,GAAG,iBAAiB;QAErG;IACF,GACA;QAACrF;QAAMH;QAAYV;QAAe4G;QAAcvG;KAAM;IAGxD,MAAM5B,gBAAgBV,YACpB,OAAOiJ;QACL,IAAI,CAACnG,MAAM;YACT,MAAM,IAAI6C,MAAM;QAClB;QAEA,IAAI;YACF,MAAMZ,WAAW,MAAMC,MAAM,GAAGrC,WAAW,CAAC,EAAEV,eAAe,EAAE;gBAC7DgD,MAAMC,KAAKJ,SAAS,CAACmE;gBACrB5D,aAAa;gBACbC,SAAS;oBACP,gBAAgB;gBAClB;gBACAC,QAAQ;YACV;YAEA,IAAI,CAACR,SAASS,EAAE,EAAE;gBAChB,MAAMC,YAAY,MAAMV,SAASW,IAAI;gBACrC,MAAM,IAAIC,MAAM,CAAC,oCAAoC,EAAEF,WAAW;YACpE;YAEA,MAAMG,OAAO,MAAMb,SAASc,IAAI;YAEhC,IAAID,KAAKE,KAAK,EAAE;gBACd,MAAM,IAAIH,MAAM,CAAC,6BAA6B,EAAEC,KAAKE,KAAK,EAAE;YAC9D;YAEA,+CAA+C;YAC/C,MAAM+C;QACR,EAAE,OAAO/C,OAAO;YACd,IAAIxD,OAAO;gBACT,sCAAsC;gBACtC4F,QAAQpC,KAAK,CAAC,uCAAuCA;YACvD;YAEA,MAAM,IAAIH,MACR,CAAC,oCAAoC,EAAEG,iBAAiBH,QAAQG,MAAMqC,OAAO,GAAG,iBAAiB;QAErG;IACF,GACA;QAACrF;QAAMH;QAAYV;QAAe4G;QAAcvG;KAAM;IAGxD,MAAM3B,gBAAgBX,YACpB,OAAOgJ;QACL,IAAI,CAAClG,MAAM;YACT,MAAM,IAAI6C,MAAM;QAClB;QAEA,IAAI;YACF,MAAMZ,WAAW,MAAMC,MAAM,GAAGrC,WAAW,CAAC,EAAEV,cAAc,CAAC,EAAE+G,WAAW,EAAE;gBAC1E3D,aAAa;gBACbC,SAAS;oBACP,gBAAgB;gBAClB;gBACAC,QAAQ;YACV;YAEA,IAAI,CAACR,SAASS,EAAE,EAAE;gBAChB,MAAMC,YAAY,MAAMV,SAASW,IAAI;gBACrC,MAAM,IAAIC,MAAM,CAAC,0BAA0B,EAAEF,WAAW;YAC1D;YAEA,MAAMG,OAAO,MAAMb,SAASc,IAAI;YAEhC,IAAID,KAAKE,KAAK,EAAE;gBACd,MAAM,IAAIH,MAAM,CAAC,sBAAsB,EAAEC,KAAKE,KAAK,EAAE;YACvD;YAEA,mCAAmC;YACnC,MAAM+C;QACR,EAAE,OAAO/C,OAAO;YACd,IAAIxD,OAAO;gBACT,sCAAsC;gBACtC4F,QAAQpC,KAAK,CAAC,2BAA2BA;YAC3C;YAEA,MAAM,IAAIH,MACR,CAAC,0BAA0B,EAAEG,iBAAiBH,QAAQG,MAAMqC,OAAO,GAAG,iBAAiB;QAE3F;IACF,GACA;QAACrF;QAAMH;QAAYV;QAAe4G;QAAcvG;KAAM;IAGxD,wDAAwD;IACxDrC,UAAU;QACR,IAAI,CAACiD,YAAYqD,OAAO,EAAE;YACxB,IAAIhE,kBAAkB;gBACpB,MAAM2G,eAAe1C,aAAa2C,OAAO,CAAC3G,mBAAmBT,GAAG;gBAChE,MAAMqH,eAAe5C,aAAa2C,OAAO,CAAC,GAAG3G,mBAAmBT,GAAG,CAAC,OAAO,CAAC;gBAE5E,IAAImH,cAAc;oBAChBjD,QAAQiD,cAAc;wBAAElD,QAAQoD,gBAAgB7F;oBAAU,GACvD8F,IAAI,CAAC,CAACT;wBACLnF,QAAQmF;wBACRxF,UAAU8F;wBACV,IAAIE,cAAc;4BAChB9F,cAAc8F;wBAChB;oBACF,GACCE,KAAK,CAAC,CAACC;wBACN,iEAAiE;wBACjE,oEAAoE;wBACpE/C,aAAa9E,UAAU,CAACc,mBAAmBT,GAAG;wBAC9CyE,aAAa9E,UAAU,CAAC,GAAGc,mBAAmBT,GAAG,CAAC,OAAO,CAAC;wBAC1DqB,UAAUG;wBACVE,QAAQF;wBACRD,cAAcC;oBAChB;gBACJ;YACF;YAEAL,YAAYqD,OAAO,GAAG;YAEtB,sCAAsC;YACtC,MAAMiD,eAAe,CAACjB;gBACpB,IAAIA,SAAS/E,IAAI,EAAEiF,QAAQF,SAAS/E,IAAI,CAACiF,IAAI,CAACC,MAAM,GAAG,GAAG;oBACxD,MAAMC,aACJ,OAAOJ,SAAS/E,IAAI,CAACiF,IAAI,CAAC,EAAE,KAAK,WAC7BF,SAAS/E,IAAI,CAACiF,IAAI,CAAC,EAAE,CAACrD,EAAE,GACxBmD,SAAS/E,IAAI,CAACiF,IAAI,CAAC,EAAE;oBAE3B,IAAIE,YAAY;wBACd1C,QAAQ0C,YACLU,IAAI,CAAC,CAACT;4BACLnF,QAAQmF;4BACRxF,UAAUuF;wBACZ,GACCW,KAAK,CAAC,CAACxD;4BACN,IAAIxD,OAAO;gCACT,sCAAsC;gCACtC4F,QAAQpC,KAAK,CAAC,6BAA6BA;4BAC7C;4BAEArC,QAAQF;4BACRH,UAAUG;4BAEV,MAAM,IAAIoC,MAAM,CAAC,2BAA2B,EAAEG,MAAMqC,OAAO,EAAE;wBAC/D;oBACJ;gBACF;YACF;YAEA,sBAAsB;YACtB,KAAKE,UAAUgB,IAAI,CAAC,CAACb;gBACnB,IAAIA,aAAa;oBACfgB,aAAahB;gBACf;YACF;QACF;IACF,GAAG;QAAClG;QAAOuG;QAAc5C;QAASoC;QAAS7F,mBAAmBT,GAAG;QAAEQ;KAAiB;IAEpFtC,UAAU;QACR,IAAI6C,MAAM;YACR,kDAAkD;YAClD,KAAK+F;QACP,OAAO;YACL,2CAA2C;YAC3C5F,aAAaM;QACf;IACF,GAAG;QAACsF;QAAc/F;KAAK;IAEvB,qBACE,KAACjB;QACC4H,OAAO;YACLlJ;YACAyC;YACAQ;YACAhD;YACAC;YACAC;YACAC;YACAC;YACAO,UAAUuC;YACVtC;YACAC;YACAC;YACAC;YACAC;YACAC;YACAC;YACAoC;YACAnC;YACAC;QACF;kBAECQ;;AAGP,EAAC;AAED,OAAO,MAAMsH,eAAe;IAC1B,MAAMC,UAAU5J,IAAI8B;IAEpB,IAAI,CAAC8H,SAAS;QACZ,MAAM,IAAIhE,MAAM;IAClB;IAEA,OAAOgE;AACT,EAAC;AAED,OAAO,MAAMC,cAAc;IACzB,MAAM,EAAEhJ,gBAAgB,EAAEO,QAAQ,EAAEQ,WAAW,EAAE,GAAG+H;IAEpD,MAAMG,iBAAiB7J,YACrB,CAACyJ,OAAuBlF;QACtB,IAAIkF,UAAUlG,aAAakG,UAAU,MAAM;YACzC,OAAO;QACT;QAEA,MAAMK,gBAAgBvF,SAASpD,YAAYA;QAE3C,IAAI,CAAC2I,eAAe;YAClB,OAAOL,MAAMM,QAAQ;QACvB;QAEA,IAAIN,UAAU,GAAG;YACf,OAAO,GAAGK,cAAc5I,MAAM,CAAC,EAAE,EAAE,IAAI8I,MAAM,CAACF,cAAc9I,QAAQ,GAAG;QACzE;QAEA,yEAAyE;QACzE,MAAMiJ,eAAeR,QAAQS,KAAKC,GAAG,CAAC,IAAIL,cAAc9I,QAAQ;QAEhE,mDAAmD;QACnD,OAAO,GAAG8I,cAAc5I,MAAM,GAAG+I,aAAaG,OAAO,CAACN,cAAc9I,QAAQ,GAAG;IACjF,GACA;QAACG;KAAS;IAGZ,IAAI,CAACA,UAAU;QACb,MAAM,IAAIwE,MAAM;IAClB;IAEA,OAAO;QACLxE;QACA0I;QACAlI;QACAb,qBAAqBF,iBAAiBE,mBAAmB;IAC3D;AACF,EAAC;AAED,OAAO,SAASuJ;IACd,MAAM,EAAE9J,OAAO,EAAEiD,IAAI,EAAEhD,SAAS,EAAEY,aAAa,EAAEC,aAAa,EAAEE,SAAS,EAAEG,UAAU,EAAE,GACrFgI;IAEF,IAAI,CAACnJ,SAAS;QACZ,MAAM,IAAIoF,MAAM;IAClB;IAEA,OAAO;QACLpF;QACAiD,MAAMA;QACNhD;QACAY;QACAC;QACAE;QACAG;IACF;AACF;AAEA,OAAO,MAAM4I,cAAc;IACzB,MAAM,EAAE7J,YAAY,EAAEa,eAAe,EAAEC,SAAS,EAAEC,cAAc,EAAEsC,qBAAqB,EAAE,GACvF4F;IAEF,IAAI,CAACpI,iBAAiB;QACpB,MAAM,IAAIqE,MAAM;IAClB;IAEA,OAAO;QAAElF;QAAca;QAAiBC;QAAWC;QAAgBsC;IAAsB;AAC3F,EAAC;AAED,OAAO,SAASyG;IACd,MAAM,EAAEvH,SAAS,EAAEtC,aAAa,EAAEC,aAAa,EAAEY,SAAS,EAAEK,aAAa,EAAE,GAAG8H;IAE9E,IAAI,CAAChJ,eAAe;QAClB,MAAM,IAAIiF,MAAM;IAClB;IAEA,OAAO;QAAE3C,WAAWA;QAAkBtC;QAAeC;QAAeY;QAAWK;IAAc;AAC/F"}