{"version":3,"sources":["../../../../src/collections/products/hooks/beforeDelete.ts"],"sourcesContent":["import type { CollectionBeforeDeleteHook } from 'payload'\n\ntype Props = {\n  variantsSlug: string\n}\n\nexport const deleteVariantsBeforeProductDelete: (args: Props) => CollectionBeforeDeleteHook =\n  ({ variantsSlug }) =>\n  async ({ id, req }) => {\n    const { docs: variants } = await req.payload.find({\n      collection: variantsSlug,\n      depth: 0,\n      limit: 0,\n      req,\n      where: {\n        product: {\n          equals: id,\n        },\n      },\n    })\n\n    await Promise.all(\n      variants.map((variant) =>\n        req.payload.delete({\n          id: variant.id,\n          collection: variantsSlug,\n          req,\n        }),\n      ),\n    )\n  }\n"],"names":["deleteVariantsBeforeProductDelete","variantsSlug","id","req","docs","variants","payload","find","collection","depth","limit","where","product","equals","Promise","all","map","variant","delete"],"mappings":"AAMA,OAAO,MAAMA,oCACX,CAAC,EAAEC,YAAY,EAAE,GACjB,OAAO,EAAEC,EAAE,EAAEC,GAAG,EAAE;QAChB,MAAM,EAAEC,MAAMC,QAAQ,EAAE,GAAG,MAAMF,IAAIG,OAAO,CAACC,IAAI,CAAC;YAChDC,YAAYP;YACZQ,OAAO;YACPC,OAAO;YACPP;YACAQ,OAAO;gBACLC,SAAS;oBACPC,QAAQX;gBACV;YACF;QACF;QAEA,MAAMY,QAAQC,GAAG,CACfV,SAASW,GAAG,CAAC,CAACC,UACZd,IAAIG,OAAO,CAACY,MAAM,CAAC;gBACjBhB,IAAIe,QAAQf,EAAE;gBACdM,YAAYP;gBACZE;YACF;IAGN,EAAC"}