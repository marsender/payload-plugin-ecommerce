{"version":3,"sources":["../../../src/collections/variants/createVariantTypesCollection.ts"],"sourcesContent":["import type { CollectionConfig, Field } from 'payload'\n\nimport type { AccessConfig } from '../../types/index.js'\n\nimport { populateTenant } from '../../utilities/populateTenant.js'\nimport { tenantBaseListFilter } from '../../utilities/tenantBaseListFilter.js'\nimport { hasTenantAccess } from '../carts/cartTenantAccess.js'\n\ntype Props = {\n  access: Pick<AccessConfig, 'isAdmin' | 'publicAccess'>\n  /**\n   * Multi-tenant configuration for variant types.\n   * When enabled, variant types will have a tenant field and access will be scoped by tenant for admins.\n   */\n  multiTenant?: {\n    enabled: boolean\n    tenantsSlug?: string\n  }\n  /**\n   * Slug of the variant options collection, defaults to 'variantOptions'.\n   */\n  variantOptionsSlug?: string\n}\n\nexport const createVariantTypesCollection: (props: Props) => CollectionConfig = (props) => {\n  const { access, multiTenant, variantOptionsSlug = 'variantOptions' } = props || {}\n\n  const tenantsSlug = multiTenant?.tenantsSlug || 'tenants'\n\n  const fields: Field[] = [\n    // Tenant field (only added when multiTenant is enabled)\n    ...(multiTenant?.enabled\n      ? [\n          {\n            name: 'tenant',\n            type: 'relationship',\n            admin: {\n              position: 'sidebar',\n              readOnly: true,\n            },\n            index: true,\n            label: ({ t }: { t: (key: string) => string }) =>\n              t('plugin-ecommerce:tenant') || 'Tenant',\n            relationTo: tenantsSlug,\n            required: false,\n          } as Field,\n        ]\n      : []),\n    {\n      name: 'label',\n      type: 'text',\n      required: true,\n    },\n    {\n      name: 'name',\n      type: 'text',\n      required: true,\n    },\n    {\n      name: 'options',\n      type: 'join',\n      collection: variantOptionsSlug,\n      maxDepth: 2,\n      on: 'variantType',\n      orderable: true,\n    },\n  ]\n\n  // Admin access: when multiTenant is enabled, use tenant-scoped access; otherwise use isAdmin\n  const adminAccess = multiTenant?.enabled\n    ? hasTenantAccess({ isAdmin: access.isAdmin })\n    : access.isAdmin\n\n  const baseConfig: CollectionConfig = {\n    slug: 'variantTypes',\n    access: {\n      create: adminAccess,\n      delete: adminAccess,\n      read: access.publicAccess,\n      update: adminAccess,\n    },\n    admin: {\n      group: false,\n      useAsTitle: 'label',\n      ...(multiTenant?.enabled && {\n        baseListFilter: tenantBaseListFilter(),\n      }),\n    },\n    fields,\n    hooks: {\n      ...(multiTenant?.enabled && {\n        beforeChange: [populateTenant({ tenantsSlug })],\n      }),\n    },\n    labels: {\n      plural: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:variantTypes'),\n      singular: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:variantType'),\n    },\n    trash: true,\n  }\n\n  return { ...baseConfig }\n}\n"],"names":["populateTenant","tenantBaseListFilter","hasTenantAccess","createVariantTypesCollection","props","access","multiTenant","variantOptionsSlug","tenantsSlug","fields","enabled","name","type","admin","position","readOnly","index","label","t","relationTo","required","collection","maxDepth","on","orderable","adminAccess","isAdmin","baseConfig","slug","create","delete","read","publicAccess","update","group","useAsTitle","baseListFilter","hooks","beforeChange","labels","plural","singular","trash"],"mappings":"AAIA,SAASA,cAAc,QAAQ,oCAAmC;AAClE,SAASC,oBAAoB,QAAQ,0CAAyC;AAC9E,SAASC,eAAe,QAAQ,+BAA8B;AAkB9D,OAAO,MAAMC,+BAAmE,CAACC;IAC/E,MAAM,EAAEC,MAAM,EAAEC,WAAW,EAAEC,qBAAqB,gBAAgB,EAAE,GAAGH,SAAS,CAAC;IAEjF,MAAMI,cAAcF,aAAaE,eAAe;IAEhD,MAAMC,SAAkB;QACtB,wDAAwD;WACpDH,aAAaI,UACb;YACE;gBACEC,MAAM;gBACNC,MAAM;gBACNC,OAAO;oBACLC,UAAU;oBACVC,UAAU;gBACZ;gBACAC,OAAO;gBACPC,OAAO,CAAC,EAAEC,CAAC,EAAkC,GAC3CA,EAAE,8BAA8B;gBAClCC,YAAYX;gBACZY,UAAU;YACZ;SACD,GACD,EAAE;QACN;YACET,MAAM;YACNC,MAAM;YACNQ,UAAU;QACZ;QACA;YACET,MAAM;YACNC,MAAM;YACNQ,UAAU;QACZ;QACA;YACET,MAAM;YACNC,MAAM;YACNS,YAAYd;YACZe,UAAU;YACVC,IAAI;YACJC,WAAW;QACb;KACD;IAED,6FAA6F;IAC7F,MAAMC,cAAcnB,aAAaI,UAC7BR,gBAAgB;QAAEwB,SAASrB,OAAOqB,OAAO;IAAC,KAC1CrB,OAAOqB,OAAO;IAElB,MAAMC,aAA+B;QACnCC,MAAM;QACNvB,QAAQ;YACNwB,QAAQJ;YACRK,QAAQL;YACRM,MAAM1B,OAAO2B,YAAY;YACzBC,QAAQR;QACV;QACAZ,OAAO;YACLqB,OAAO;YACPC,YAAY;YACZ,GAAI7B,aAAaI,WAAW;gBAC1B0B,gBAAgBnC;YAClB,CAAC;QACH;QACAQ;QACA4B,OAAO;YACL,GAAI/B,aAAaI,WAAW;gBAC1B4B,cAAc;oBAACtC,eAAe;wBAAEQ;oBAAY;iBAAG;YACjD,CAAC;QACH;QACA+B,QAAQ;YACNC,QAAQ,CAAC,EAAEtB,CAAC,EAAE,GACZ,+DAA+D;gBAC/DA,EAAE;YACJuB,UAAU,CAAC,EAAEvB,CAAC,EAAE,GACd,+DAA+D;gBAC/DA,EAAE;QACN;QACAwB,OAAO;IACT;IAEA,OAAO;QAAE,GAAGf,UAAU;IAAC;AACzB,EAAC"}