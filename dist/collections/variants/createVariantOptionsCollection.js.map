{"version":3,"sources":["../../../src/collections/variants/createVariantOptionsCollection.ts"],"sourcesContent":["import type { CollectionConfig, Field } from 'payload'\n\nimport type { AccessConfig } from '../../types/index.js'\n\nimport { populateTenant } from '../../utilities/populateTenant.js'\nimport { tenantBaseListFilter } from '../../utilities/tenantBaseListFilter.js'\nimport { hasTenantAccess } from '../carts/cartTenantAccess.js'\n\ntype Props = {\n  access: Pick<AccessConfig, 'isAdmin' | 'publicAccess'>\n  /**\n   * Multi-tenant configuration for variant options.\n   * When enabled, variant options will have a tenant field and access will be scoped by tenant for admins.\n   */\n  multiTenant?: {\n    enabled: boolean\n    tenantsSlug?: string\n  }\n  /**\n   * Slug of the variant types collection, defaults to 'variantTypes'.\n   */\n  variantTypesSlug?: string\n}\n\nexport const createVariantOptionsCollection: (props: Props) => CollectionConfig = (props) => {\n  const { access, multiTenant, variantTypesSlug = 'variantTypes' } = props || {}\n\n  const tenantsSlug = multiTenant?.tenantsSlug || 'tenants'\n\n  const fields: Field[] = [\n    // Tenant field (only added when multiTenant is enabled)\n    ...(multiTenant?.enabled\n      ? [\n          {\n            name: 'tenant',\n            type: 'relationship',\n            admin: {\n              position: 'sidebar',\n              readOnly: true,\n            },\n            index: true,\n            label: ({ t }: { t: (key: string) => string }) =>\n              t('plugin-ecommerce:tenant') || 'Tenant',\n            relationTo: tenantsSlug,\n            required: false,\n          } as Field,\n        ]\n      : []),\n    {\n      name: 'variantType',\n      type: 'relationship',\n      admin: {\n        readOnly: true,\n      },\n      relationTo: variantTypesSlug,\n      required: true,\n    },\n    {\n      name: 'label',\n      type: 'text',\n      required: true,\n    },\n    {\n      name: 'value',\n      type: 'text',\n      admin: {\n        description: 'should be defaulted or dynamic based on label',\n      },\n      required: true,\n    },\n  ]\n\n  // Admin access: when multiTenant is enabled, use tenant-scoped access; otherwise use isAdmin\n  const adminAccess = multiTenant?.enabled\n    ? hasTenantAccess({ isAdmin: access.isAdmin })\n    : access.isAdmin\n\n  const baseConfig: CollectionConfig = {\n    slug: 'variantOptions',\n    access: {\n      create: adminAccess,\n      delete: adminAccess,\n      read: access.publicAccess,\n      update: adminAccess,\n    },\n    admin: {\n      group: false,\n      useAsTitle: 'label',\n      ...(multiTenant?.enabled && {\n        baseListFilter: tenantBaseListFilter(),\n      }),\n    },\n    fields,\n    hooks: {\n      ...(multiTenant?.enabled && {\n        beforeChange: [populateTenant({ tenantsSlug })],\n      }),\n    },\n    labels: {\n      plural: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:variantOptions'),\n      singular: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:variantOption'),\n    },\n    trash: true,\n  }\n\n  return { ...baseConfig }\n}\n"],"names":["populateTenant","tenantBaseListFilter","hasTenantAccess","createVariantOptionsCollection","props","access","multiTenant","variantTypesSlug","tenantsSlug","fields","enabled","name","type","admin","position","readOnly","index","label","t","relationTo","required","description","adminAccess","isAdmin","baseConfig","slug","create","delete","read","publicAccess","update","group","useAsTitle","baseListFilter","hooks","beforeChange","labels","plural","singular","trash"],"mappings":"AAIA,SAASA,cAAc,QAAQ,oCAAmC;AAClE,SAASC,oBAAoB,QAAQ,0CAAyC;AAC9E,SAASC,eAAe,QAAQ,+BAA8B;AAkB9D,OAAO,MAAMC,iCAAqE,CAACC;IACjF,MAAM,EAAEC,MAAM,EAAEC,WAAW,EAAEC,mBAAmB,cAAc,EAAE,GAAGH,SAAS,CAAC;IAE7E,MAAMI,cAAcF,aAAaE,eAAe;IAEhD,MAAMC,SAAkB;QACtB,wDAAwD;WACpDH,aAAaI,UACb;YACE;gBACEC,MAAM;gBACNC,MAAM;gBACNC,OAAO;oBACLC,UAAU;oBACVC,UAAU;gBACZ;gBACAC,OAAO;gBACPC,OAAO,CAAC,EAAEC,CAAC,EAAkC,GAC3CA,EAAE,8BAA8B;gBAClCC,YAAYX;gBACZY,UAAU;YACZ;SACD,GACD,EAAE;QACN;YACET,MAAM;YACNC,MAAM;YACNC,OAAO;gBACLE,UAAU;YACZ;YACAI,YAAYZ;YACZa,UAAU;QACZ;QACA;YACET,MAAM;YACNC,MAAM;YACNQ,UAAU;QACZ;QACA;YACET,MAAM;YACNC,MAAM;YACNC,OAAO;gBACLQ,aAAa;YACf;YACAD,UAAU;QACZ;KACD;IAED,6FAA6F;IAC7F,MAAME,cAAchB,aAAaI,UAC7BR,gBAAgB;QAAEqB,SAASlB,OAAOkB,OAAO;IAAC,KAC1ClB,OAAOkB,OAAO;IAElB,MAAMC,aAA+B;QACnCC,MAAM;QACNpB,QAAQ;YACNqB,QAAQJ;YACRK,QAAQL;YACRM,MAAMvB,OAAOwB,YAAY;YACzBC,QAAQR;QACV;QACAT,OAAO;YACLkB,OAAO;YACPC,YAAY;YACZ,GAAI1B,aAAaI,WAAW;gBAC1BuB,gBAAgBhC;YAClB,CAAC;QACH;QACAQ;QACAyB,OAAO;YACL,GAAI5B,aAAaI,WAAW;gBAC1ByB,cAAc;oBAACnC,eAAe;wBAAEQ;oBAAY;iBAAG;YACjD,CAAC;QACH;QACA4B,QAAQ;YACNC,QAAQ,CAAC,EAAEnB,CAAC,EAAE,GACZ,+DAA+D;gBAC/DA,EAAE;YACJoB,UAAU,CAAC,EAAEpB,CAAC,EAAE,GACd,+DAA+D;gBAC/DA,EAAE;QACN;QACAqB,OAAO;IACT;IAEA,OAAO;QAAE,GAAGf,UAAU;IAAC;AACzB,EAAC"}