{"version":3,"sources":["../../../src/collections/transactions/createTransactionsCollection.ts"],"sourcesContent":["import type { CollectionConfig, Field } from 'payload'\n\nimport type { AccessConfig, CurrenciesConfig, PaymentAdapter } from '../../types/index.js'\n\nimport { amountField } from '../../fields/amountField.js'\nimport { cartItemsField } from '../../fields/cartItemsField.js'\nimport { currencyField } from '../../fields/currencyField.js'\nimport { statusField } from '../../fields/statusField.js'\nimport { tenantBaseListFilter } from '../carts/tenantBaseListFilter.js'\n\ntype Props = {\n  access: Pick<AccessConfig, 'isAdmin'>\n  /**\n   * Array of fields used for capturing the billing address.\n   */\n  addressFields?: Field[]\n  /**\n   * Slug of the carts collection, defaults to 'carts'.\n   */\n  cartsSlug?: string\n  currenciesConfig?: CurrenciesConfig\n  /**\n   * Slug of the customers collection, defaults to 'users'.\n   */\n  customersSlug?: string\n  /**\n   * Enable variants in the transactions collection.\n   */\n  enableVariants?: boolean\n  /**\n   * Multi-tenant configuration for transactions.\n   * When enabled, transactions will have a tenant field and access will be scoped by tenant for admins.\n   */\n  multiTenant?: {\n    /**\n     * Whether multi-tenant support is enabled.\n     */\n    enabled: boolean\n    /**\n     * The slug of the tenants collection.\n     * @default 'tenants'\n     */\n    tenantsSlug?: string\n  }\n  /**\n   * Slug of the orders collection, defaults to 'orders'.\n   */\n  ordersSlug?: string\n  paymentMethods?: PaymentAdapter[]\n  /**\n   * Slug of the products collection, defaults to 'products'.\n   */\n  productsSlug?: string\n  /**\n   * Slug of the variants collection, defaults to 'variants'.\n   */\n  variantsSlug?: string\n}\n\nexport const createTransactionsCollection: (props: Props) => CollectionConfig = (props) => {\n  const {\n    access,\n    addressFields,\n    cartsSlug = 'carts',\n    currenciesConfig,\n    customersSlug = 'users',\n    enableVariants = false,\n    multiTenant,\n    ordersSlug = 'orders',\n    paymentMethods,\n    productsSlug = 'products',\n    variantsSlug = 'variants',\n  } = props || {}\n\n  const tenantsSlug = multiTenant?.tenantsSlug || 'tenants'\n\n  const fields: Field[] = [\n    // Tenant field (only added when multiTenant is enabled)\n    ...(multiTenant?.enabled\n      ? [\n          {\n            name: 'tenant',\n            type: 'relationship',\n            relationTo: tenantsSlug,\n            required: false,\n            index: true,\n            admin: {\n              position: 'sidebar',\n              readOnly: true,\n            },\n            label: ({ t }) =>\n              // @ts-expect-error - translations are not typed in plugins yet\n              t('plugin-ecommerce:tenant') || 'Tenant',\n          } as Field,\n        ]\n      : []),\n    {\n      type: 'tabs',\n      tabs: [\n        {\n          fields: [\n            cartItemsField({\n              enableVariants,\n              overrides: {\n                name: 'items',\n                label: ({ t }) =>\n                  // @ts-expect-error - translations are not typed in plugins yet\n                  t('plugin-ecommerce:items'),\n                labels: {\n                  plural: ({ t }) =>\n                    // @ts-expect-error - translations are not typed in plugins yet\n                    t('plugin-ecommerce:items'),\n                  singular: ({ t }) =>\n                    // @ts-expect-error - translations are not typed in plugins yet\n                    t('plugin-ecommerce:item'),\n                },\n              },\n              productsSlug,\n              variantsSlug,\n            }),\n            ...(paymentMethods?.length && paymentMethods.length > 0\n              ? [\n                  {\n                    name: 'paymentMethod',\n                    type: 'select',\n                    label: ({ t }) =>\n                      // @ts-expect-error - translations are not typed in plugins yet\n                      t('plugin-ecommerce:paymentMethod'),\n                    options: paymentMethods.map((method) => ({\n                      label: method.label ?? method.name,\n                      value: method.name,\n                    })),\n                  } as Field,\n                  ...(paymentMethods.map((method) => method.group) || []),\n                ]\n              : []),\n          ],\n          label: ({ t }) =>\n            // @ts-expect-error - translations are not typed in plugins yet\n            t('plugin-ecommerce:transactionDetails'),\n        },\n        {\n          fields: [\n            ...(addressFields\n              ? [\n                  {\n                    name: 'billingAddress',\n                    type: 'group',\n                    fields: addressFields,\n                    label: ({ t }) =>\n                      // @ts-expect-error - translations are not typed in plugins yet\n                      t('plugin-ecommerce:billingAddress'),\n                  } as Field,\n                ]\n              : []),\n          ],\n          label: ({ t }) =>\n            // @ts-expect-error - translations are not typed in plugins yet\n            t('plugin-ecommerce:billing'),\n        },\n      ],\n    },\n    statusField({\n      overrides: {\n        admin: {\n          position: 'sidebar',\n        },\n      },\n    }),\n    {\n      name: 'customer',\n      type: 'relationship',\n      admin: {\n        position: 'sidebar',\n      },\n      label: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:customer'),\n      relationTo: customersSlug,\n    },\n    {\n      name: 'customerEmail',\n      type: 'email',\n      admin: {\n        position: 'sidebar',\n      },\n      label: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:customerEmail'),\n    },\n    {\n      name: 'order',\n      type: 'relationship',\n      admin: {\n        position: 'sidebar',\n      },\n      label: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:order'),\n      relationTo: ordersSlug,\n    },\n    {\n      name: 'cart',\n      type: 'relationship',\n      admin: {\n        position: 'sidebar',\n      },\n      relationTo: cartsSlug,\n    },\n    ...(currenciesConfig\n      ? [\n          {\n            type: 'row',\n            admin: {\n              position: 'sidebar',\n            },\n            fields: [\n              amountField({\n                currenciesConfig,\n              }),\n              currencyField({\n                currenciesConfig,\n              }),\n            ],\n          } as Field,\n        ]\n      : []),\n  ]\n\n  const baseConfig: CollectionConfig = {\n    slug: 'transactions',\n    access: {\n      create: access.isAdmin,\n      delete: access.isAdmin,\n      read: access.isAdmin,\n      update: access.isAdmin,\n    },\n    admin: {\n      defaultColumns: ['createdAt', 'customer', 'order', 'amount', 'status'],\n      description: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:transactionsCollectionDescription'),\n      group: 'Ecommerce',\n      // Filter list view by tenant when multiTenant is enabled\n      ...(multiTenant?.enabled && {\n        baseListFilter: tenantBaseListFilter(),\n      }),\n    },\n    fields,\n    labels: {\n      plural: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:transactions'),\n      singular: ({ t }) =>\n        // @ts-expect-error - translations are not typed in plugins yet\n        t('plugin-ecommerce:transaction'),\n    },\n  }\n\n  return { ...baseConfig }\n}\n"],"names":["amountField","cartItemsField","currencyField","statusField","tenantBaseListFilter","createTransactionsCollection","props","access","addressFields","cartsSlug","currenciesConfig","customersSlug","enableVariants","multiTenant","ordersSlug","paymentMethods","productsSlug","variantsSlug","tenantsSlug","fields","enabled","name","type","relationTo","required","index","admin","position","readOnly","label","t","tabs","overrides","labels","plural","singular","length","options","map","method","value","group","baseConfig","slug","create","isAdmin","delete","read","update","defaultColumns","description","baseListFilter"],"mappings":"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"}